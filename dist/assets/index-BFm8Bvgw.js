import{r as j,j as e}from"./react-BVBiHVO-.js";import{r as Be,c as $t}from"./react-dom-C1qW5AtE.js";import{g as zt,o as It,s as At,a as Mt}from"./firebase-DXYueZsg.js";import{y as Ot,z as Et,A as Tt,B as he,D as ze,G as Ft,H as nt,I as fe,J as ot,K as Re,M as Se,N as Lt,O as at,P as Pt,Q as Rt,R as _t,T as Ut,U as qt}from"./@firebase-BQo0rUhx.js";import{S as _e,X as xe,M as yt,a as ke,A as Ie,C as Ue,b as Ke,c as Ae,N as ct,d as ue,P as Me,T as Nt,U as Ne,e as Je,f as qe,g as je,h as Ge,L as vt,i as Qe,D as We,j as be,k as Ce,l as lt,W as Gt,m as Oe,n as ne,o as xt,p as mt,q as wt,r as Ee,s as Ht,Z as Jt,t as Ve,u as ht,v as $e,F as kt,w as Wt,x as Yt,y as Bt,z as bt,B as rt,E as pe,G as Te,H as Ze,I as gt,J as ve,K as Kt,O as we,Q as St,R as dt,V as Vt,Y as ut,_ as Fe,$ as Dt,a0 as Qt,a1 as Ct,a2 as Zt,a3 as Xt,a4 as es,a5 as ts,a6 as ss}from"./lucide-react-CBaVgNjt.js";import"./scheduler-DYLXRpC5.js";import"./idb-BXWtuYvb.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))x(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&x(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function x(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const as={apiKey:"AIzaSyCKMrH2E_GP_MYZJrhF4LbxC1LmtVGx3Co",authDomain:"brave-academy.firebaseapp.com",projectId:"brave-academy",storageBucket:"brave-academy.firebasestorage.app",messagingSenderId:"862804404676",appId:"1:862804404676:web:871e3bb0796c354f1f5c91"},it=Ot(as),Xe=zt(it),ee=Et(it),ls=Tt(it),ie="brave-academy-live-data",re=(s,a=[])=>{const[o,x]=j.useState([]),[r,c]=j.useState(!0),l=JSON.stringify(a);return j.useEffect(()=>{let p=he(ee,"artifacts",ie,"public","data",s),i;a&&a.length>0?i=ze(p,...a):i=ze(p);const N=Ft(i,f=>{const g=f.docs.map(m=>({...m.data(),id:m.id}));x(g),c(!1)},f=>{console.error(`Error fetching ${s}:`,f),c(!1)});return()=>N()},[s,l]),{data:o,loading:r,add:async p=>{try{const i={...p,createdAt:new Date().toISOString()};return await Re(he(ee,"artifacts",ie,"public","data",s),i),!0}catch(i){return console.error(i),alert("خطأ في الحفظ، تأكد من الاتصال"),!1}},update:async(p,i)=>{try{await ot(fe(ee,"artifacts",ie,"public","data",s,p),i)}catch(N){console.error(N)}},remove:async p=>{try{await nt(fe(ee,"artifacts",ie,"public","data",s,p))}catch(i){console.error(i)}}}},F=({children:s,onClick:a,variant:o="primary",className:x="",type:r="button"})=>{const c={primary:"bg-yellow-500 text-black hover:bg-yellow-400 border border-yellow-600 font-bold",secondary:"bg-gray-800 text-white hover:bg-gray-700",danger:"bg-red-600 text-white hover:bg-red-700",outline:"border-2 border-yellow-500 text-yellow-600 hover:bg-yellow-50",ghost:"bg-transparent text-gray-600 hover:bg-gray-100"};return e.jsx("button",{type:r,onClick:a,className:`px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center gap-2 shadow-sm ${c[o]} ${x}`,children:s})},J=({children:s,className:a="",title:o,action:x,noPadding:r=!1})=>e.jsxs("div",{className:`bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden ${a}`,children:[(o||x)&&e.jsxs("div",{className:"px-4 py-3 md:px-6 md:py-4 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center bg-gray-50/50 gap-2",children:[o&&e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:o}),x&&e.jsx("div",{className:"self-end md:self-auto",children:x})]}),e.jsx("div",{className:r?"":"p-4 md:p-6",children:s})]}),Le=({status:s})=>{const a={active:{text:"فعال",style:"bg-green-100 text-green-800 border-green-200"},near_end:{text:"قارب الانتهاء",style:"bg-yellow-100 text-yellow-800 border-yellow-200"},expired:{text:"منتهي",style:"bg-red-100 text-red-800 border-red-200"}},o=a[s]||a.active;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold border ${o.style}`,children:o.text})},Ye=({students:s,onSelect:a,placeholder:o="بحث عن طالب...",showAllOption:x=!1,onClear:r})=>{const[c,l]=j.useState(""),[b,v]=j.useState(!1),w=j.useMemo(()=>c?s.filter(p=>p.name.includes(c)):s,[s,c]);return e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"w-full border p-2 pr-8 rounded focus:ring-2 focus:ring-yellow-500 outline-none",placeholder:o,value:c,onChange:p=>{l(p.target.value),v(!0),p.target.value===""&&r&&r()},onFocus:()=>v(!0),onBlur:()=>setTimeout(()=>v(!1),200)}),e.jsx(_e,{className:"absolute left-2 top-2.5 text-gray-400",size:16}),c&&e.jsx("button",{onClick:()=>{l(""),r&&r()},className:"absolute left-8 top-2.5 text-gray-400 hover:text-red-500",children:e.jsx(xe,{size:16})})]}),b&&e.jsxs("div",{className:"absolute z-50 w-full bg-white border rounded shadow-lg max-h-48 overflow-y-auto mt-1",children:[x&&e.jsx("div",{className:"p-2 hover:bg-gray-100 cursor-pointer text-sm border-b font-bold text-blue-600",onClick:()=>{l(""),r&&r(),v(!1)},children:"عرض الكل"}),w.length>0?w.map(p=>e.jsxs("div",{className:"p-2 hover:bg-yellow-50 cursor-pointer text-sm border-b last:border-0 flex justify-between items-center",onClick:()=>{l(p.name),a(p),v(!1)},children:[e.jsx("span",{className:"font-bold",children:p.name}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded",children:p.belt})]},p.id)):e.jsx("div",{className:"p-2 text-gray-500 text-sm text-center",children:"لا توجد نتائج"})]})]})},de={LOGO:"/logo.jpg",HERO_BG:"/hero.jpg",BRANCH_SHAFA:"/shafa.jpg",BRANCH_ABU_NSEIR:"/abunseir.jpg"},se={SHAFA:"شفا بدران",ABU_NSEIR:"أبو نصير"},V=["أبيض","أصفر","أخضر 1","أخضر 2","أزرق 1","أزرق 2","بني 1","بني 2","أحمر 1","أحمر 2","أسود"],rs=[{id:1,days:"السبت / الاثنين / الأربعاء",time:"4:00 م - 5:00 م",level:"مبتدئين (أبيض - أصفر)",branch:"مشترك"},{id:2,days:"السبت / الاثنين / الأربعاء",time:"5:00 م - 6:30 م",level:"أحزمة ملونة (أخضر - أزرق)",branch:"مشترك"},{id:3,days:"الأحد / الثلاثاء / الخميس",time:"5:00 م - 6:30 م",level:"متقدم (أحمر - أسود)",branch:"مشترك"},{id:4,days:"الجمعة",time:"9:00 ص - 11:00 ص",level:"فريق المنتخبات",branch:"الفرع الرئيسي"}],ns=({setView:s,schedule:a})=>{const[o,x]=j.useState(!1),[r,c]=j.useState(!1),[l,b]=j.useState({name:"",phone:"",dob:"",address:"",branch:se.SHAFA}),[v,w]=j.useState(!1),{data:p}=re("news"),[i,N]=j.useState(0);j.useEffect(()=>{if(!p||p.length===0)return;const d=setInterval(()=>{N($=>($+1)%p.length)},8e3);return()=>clearInterval(d)},[p]);const f=d=>{if(!d)return"";const $=new Date(d);if(isNaN($.getTime()))return d;const u=String($.getDate()).padStart(2,"0"),S=String($.getMonth()+1).padStart(2,"0"),M=$.getFullYear();return`${u}/${S}/${M}`},g=async d=>{d.preventDefault(),w(!0);try{await Re(he(ee,"artifacts",ie,"public","data","registrations"),{...l,dob:f(l.dob),date:f(new Date),status:"new",createdAt:new Date().toISOString()}),alert("تم إرسال طلب التسجيل بنجاح! سنتواصل معك قريباً."),c(!1),b({name:"",phone:"",dob:"",address:"",branch:se.SHAFA})}catch($){console.error("Error adding document: ",$),alert("حدث خطأ أثناء الإرسال، يرجى المحاولة مرة أخرى.")}finally{w(!1)}},m=d=>window.open(d,"_blank"),I=()=>window.open("https://wa.me/962795629606","_blank");return e.jsxs("div",{className:"min-h-screen font-sans text-right relative bg-white",dir:"rtl",children:[e.jsxs("header",{className:"bg-black text-white shadow-lg sticky top-0 z-50 border-b-2 border-yellow-500",children:[e.jsxs("div",{className:"container mx-auto px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>window.scrollTo(0,0),children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:de.LOGO,alt:"Logo",className:"w-12 h-12 rounded-full bg-white p-1 object-contain transition-transform group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-yellow-500 animate-pulse"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-extrabold leading-none text-yellow-500",children:"أكاديمية الشجاع"}),e.jsx("p",{className:"text-[10px] text-gray-400 tracking-wider uppercase font-bold",children:"Brave Taekwondo"})]})]}),e.jsx("nav",{className:"hidden md:flex gap-8 font-bold text-sm",children:["الرئيسية","من نحن","جدول الحصص","الفروع"].map(d=>e.jsxs("button",{className:"hover:text-yellow-500 transition-colors duration-300 relative group",onClick:()=>{var $,u;d==="جدول الحصص"&&(($=document.getElementById("schedule"))==null||$.scrollIntoView({behavior:"smooth"})),d==="الفروع"&&((u=document.getElementById("branches"))==null||u.scrollIntoView({behavior:"smooth"})),d==="الرئيسية"&&window.scrollTo(0,0)},children:[d,e.jsx("span",{className:"absolute -bottom-1 right-0 w-0 h-0.5 bg-yellow-500 transition-all group-hover:w-full"})]},d))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{onClick:()=>s("login"),className:"bg-yellow-500 text-black hover:bg-yellow-400 font-black px-6 border-none hidden md:block transform hover:-translate-y-1 transition-transform",children:"بوابة الأعضاء"}),e.jsx("button",{className:"md:hidden p-2 text-yellow-500",onClick:()=>x(!o),children:o?e.jsx(xe,{size:24}):e.jsx(yt,{size:24})})]})]}),o&&e.jsx("div",{className:"md:hidden bg-gray-900 border-t border-gray-800 p-4 flex flex-col gap-4",children:e.jsx(F,{onClick:()=>{x(!1),s("login")},className:"w-full py-3 bg-yellow-500 text-black font-bold",children:"بوابة الأعضاء"})})]}),e.jsxs("div",{className:"relative bg-gray-900 text-white h-[600px] flex items-center shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-1/2 h-full bg-yellow-500/10 -skew-x-12 transform origin-top translate-x-20"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/70 to-transparent z-10"}),e.jsx("img",{src:de.HERO_BG,alt:"Hero",className:"absolute inset-0 w-full h-full object-cover"}),e.jsxs("div",{className:"container mx-auto px-6 relative z-20 flex flex-col items-start pt-10",children:[e.jsx("div",{className:"inline-block bg-yellow-500 text-black font-black px-4 py-1 rounded-none skew-x-[-10deg] mb-6 animate-fade-in-up",children:e.jsx("span",{className:"block skew-x-[10deg] text-sm tracking-wider",children:"التسجيل مفتوح الآن"})}),e.jsxs("h2",{className:"text-6xl md:text-8xl font-black mb-6 leading-tight drop-shadow-lg",children:["اصنع ",e.jsx("span",{className:"text-yellow-500",children:"قوتك"}),e.jsx("br",{}),"ابنِ مستقبلك"]}),e.jsx("p",{className:"text-gray-300 text-lg mb-8 max-w-lg font-medium",children:"انضم إلى نخبة أبطال الأردن في التايكوندو. تدريب احترافي، بيئة آمنة، ومستقبل واعد."}),e.jsx("div",{className:"flex gap-4",children:e.jsx(F,{onClick:()=>c(!0),className:"px-10 py-4 text-xl bg-yellow-500 text-black font-black hover:bg-yellow-400 hover:scale-105 transition-all shadow-[0_0_20px_rgba(234,179,8,0.5)] border-none",children:"ابدأ رحلتك"})})]})]}),p&&p.length>0&&e.jsx("section",{className:"relative -mt-16 z-30 mb-20",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"relative w-full max-w-5xl mx-auto h-[450px] bg-white rounded-2xl overflow-hidden shadow-2xl border-t-8 border-yellow-500 flex flex-col md:flex-row",children:p.map((d,$)=>e.jsxs("div",{className:`absolute inset-0 flex flex-col md:flex-row transition-all duration-700 ease-in-out ${$===i?"opacity-100 z-10":"opacity-0 z-0"}`,children:[e.jsxs("div",{className:"w-full md:w-1/2 h-1/2 md:h-full relative overflow-hidden",children:[d.image?e.jsx("img",{src:d.image,alt:d.title,className:"w-full h-full object-cover transition-transform duration-[10000ms] ease-linear transform scale-100 hover:scale-110"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(ke,{size:64,className:"text-gray-300"})}),e.jsx("div",{className:"absolute top-4 right-4 bg-yellow-500 text-black text-xs font-bold px-3 py-1 shadow-md",children:d.branch})]}),e.jsxs("div",{className:"w-full md:w-1/2 h-1/2 md:h-full bg-white p-8 flex flex-col justify-center text-right relative",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 font-bold mb-2 text-sm uppercase tracking-wide",children:[e.jsx(Ie,{size:16}),e.jsx("span",{children:"أحدث الأخبار"})]}),e.jsx("h3",{className:"text-2xl md:text-4xl font-black text-gray-900 mb-4 leading-tight",children:d.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed text-sm md:text-base",children:d.desc}),e.jsxs("div",{className:"flex gap-2 mt-8",children:[e.jsx("button",{onClick:()=>N(u=>(u-1+p.length)%p.length),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:bg-black hover:text-white transition-colors",children:e.jsx(Ue,{size:20})}),e.jsx("button",{onClick:()=>N(u=>(u+1)%p.length),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:bg-black hover:text-white transition-colors",children:e.jsx(Ke,{size:20})})]})]})]},d.id))})})}),e.jsx("section",{id:"branches",className:"py-24 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-16",children:[e.jsx("h2",{className:"text-5xl font-black text-gray-900 mb-4 tracking-tight",children:"فروعنا"}),e.jsx("div",{className:"w-24 h-2 bg-yellow-500 rounded-full"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"group relative h-[500px] w-full rounded-[2.5rem] overflow-hidden shadow-2xl cursor-default",children:[e.jsx("img",{src:de.BRANCH_SHAFA,alt:"Shafa",className:"absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent opacity-90 transition-opacity duration-300"}),e.jsx("div",{className:"absolute inset-0 p-8 md:p-12 flex flex-col justify-end",children:e.jsxs("div",{className:"transform transition-transform duration-500 translate-y-4 group-hover:translate-y-0",children:[e.jsx("div",{className:"flex justify-between items-end mb-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"inline-block bg-yellow-500 text-black text-xs font-black px-3 py-1 rounded-full mb-3 shadow-lg",children:"الفرع الرئيسي"}),e.jsx("h3",{className:"text-4xl md:text-5xl font-black text-white leading-none mb-2",children:"شفا بدران"}),e.jsxs("div",{className:"flex items-start gap-2 text-gray-300 text-sm md:text-base font-medium max-w-sm",children:[e.jsx(Ae,{className:"text-yellow-500 mt-1 shrink-0",size:18}),e.jsx("p",{children:"شارع رفعت شموط - بجانب مشاتل ربيع الاردن"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[e.jsxs("button",{onClick:()=>m("https://maps.app.goo.gl/mTqvZD4Ftor3NALJ8?g_st=ic"),className:"flex items-center justify-center gap-2 bg-white/20 backdrop-blur-md border border-white/30 text-white font-bold py-4 rounded-2xl hover:bg-white hover:text-black transition-all duration-300",children:[e.jsx(ct,{size:20}),e.jsx("span",{children:"الموقع"})]}),e.jsxs("button",{onClick:()=>window.open("https://wa.me/962795629606","_blank"),className:"flex items-center justify-center gap-2 bg-[#25D366]/90 backdrop-blur-md text-white font-bold py-4 rounded-2xl hover:bg-[#25D366] transition-all duration-300 shadow-lg shadow-green-900/20",children:[e.jsx(ue,{size:20}),e.jsx("span",{children:"واتساب"})]})]}),e.jsxs("a",{href:"tel:0795629606",className:"mt-3 flex items-center justify-center gap-2 bg-black/60 backdrop-blur-md border border-white/10 text-white font-bold py-4 rounded-2xl hover:bg-yellow-500 hover:text-black transition-all duration-300",children:[e.jsx(Me,{size:20}),e.jsx("span",{dir:"ltr",children:"07 9562 9606"})]})]})})]}),e.jsxs("div",{className:"group relative h-[500px] w-full rounded-[2.5rem] overflow-hidden shadow-2xl cursor-default",children:[e.jsx("img",{src:de.BRANCH_ABU_NSEIR,alt:"Abu Nseir",className:"absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent opacity-90 transition-opacity duration-300"}),e.jsx("div",{className:"absolute inset-0 p-8 md:p-12 flex flex-col justify-end",children:e.jsxs("div",{className:"transform transition-transform duration-500 translate-y-4 group-hover:translate-y-0",children:[e.jsx("div",{className:"flex justify-between items-end mb-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"inline-block bg-gray-800 text-white text-xs font-black px-3 py-1 rounded-full mb-3 shadow-lg border border-gray-600",children:"فرع 2"}),e.jsx("h3",{className:"text-4xl md:text-5xl font-black text-white leading-none mb-2",children:"أبو نصير"}),e.jsxs("div",{className:"flex items-start gap-2 text-gray-300 text-sm md:text-base font-medium max-w-sm",children:[e.jsx(Ae,{className:"text-yellow-500 mt-1 shrink-0",size:18}),e.jsx("p",{children:"دوار البحرية - مجمع الفرا"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[e.jsxs("button",{onClick:()=>m("https://maps.app.goo.gl/yqu6tWBiqrRWGCMJ8?g_st=ic"),className:"flex items-center justify-center gap-2 bg-white/20 backdrop-blur-md border border-white/30 text-white font-bold py-4 rounded-2xl hover:bg-white hover:text-black transition-all duration-300",children:[e.jsx(ct,{size:20}),e.jsx("span",{children:"الموقع"})]}),e.jsxs("button",{onClick:()=>window.open("https://wa.me/962790368603","_blank"),className:"flex items-center justify-center gap-2 bg-[#25D366]/90 backdrop-blur-md text-white font-bold py-4 rounded-2xl hover:bg-[#25D366] transition-all duration-300 shadow-lg shadow-green-900/20",children:[e.jsx(ue,{size:20}),e.jsx("span",{children:"واتساب"})]})]}),e.jsxs("a",{href:"tel:0790368603",className:"mt-3 flex items-center justify-center gap-2 bg-black/60 backdrop-blur-md border border-white/10 text-white font-bold py-4 rounded-2xl hover:bg-yellow-500 hover:text-black transition-all duration-300",children:[e.jsx(Me,{size:20}),e.jsx("span",{dir:"ltr",children:"07 9036 8603"})]})]})})]})]})]})}),e.jsx("section",{className:"py-24 relative overflow-hidden bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[e.jsxs("div",{className:"flex flex-col items-center mb-16 text-center",children:[e.jsx("span",{className:"text-yellow-500 font-bold tracking-widest text-sm uppercase mb-2",children:"لماذا نحن؟"}),e.jsxs("h2",{className:"text-4xl md:text-5xl font-black text-gray-900 mb-4",children:["أكثر من مجرد ",e.jsx("span",{className:"text-yellow-500",children:"رياضة"})]}),e.jsx("p",{className:"text-gray-500 max-w-xl",children:"نحن نبني شخصية طفلك، نعزز ثقته بنفسه، ونعده ليكون قائداً في المستقبل."})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:[{icon:Nt,title:"صناعة الأبطال",text:"منهج تدريبي احترافي يهدف للوصول باللاعبين لمنصات التتويج المحلية والدولية."},{icon:Ne,title:"كادر محترف",text:"نخبة من المدربين الوطنيين والدوليين المعتمدين ذوي الخبرة العالية."},{icon:Je,title:"بيئة آمنة",text:"نهتم بالجانب التربوي والأخلاقي قبل الجانب البدني، في بيئة عائلية آمنة."}].map((d,$)=>e.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100 relative group overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-500 to-yellow-200 transform origin-left scale-x-0 group-hover:scale-x-100 transition-transform duration-500"}),e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-2xl flex items-center justify-center text-yellow-600 mb-6 group-hover:scale-110 transition-transform group-hover:bg-yellow-500 group-hover:text-black",children:e.jsx(d.icon,{size:32,strokeWidth:2})}),e.jsx("h3",{className:"text-xl font-bold mb-3 text-gray-900",children:d.title}),e.jsx("p",{className:"text-gray-500 leading-relaxed text-sm",children:d.text})]},$))})]})}),e.jsxs("section",{id:"schedule",className:"py-20 bg-gray-900 text-white relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#FDE047 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[e.jsxs("div",{className:"flex flex-col items-center mb-16",children:[e.jsx("h2",{className:"text-4xl font-black mb-4",children:"جدول الحصص الأسبوعي"}),e.jsx("div",{className:"w-20 h-1.5 bg-yellow-500 rounded-full"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(a&&a.length>0?a:rs).map(d=>e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700 hover:border-yellow-500 transition-all duration-300 hover:-translate-y-2 group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-yellow-500 group-hover:bg-yellow-500 group-hover:text-black transition-colors",children:e.jsx(qe,{size:20})}),e.jsx("span",{className:"text-xs font-bold text-gray-400 bg-black/30 px-2 py-1 rounded",children:d.branch})]}),e.jsx("h3",{className:"font-bold text-xl mb-2 text-white",children:d.level}),e.jsxs("div",{className:"space-y-3 mt-6 border-t border-gray-700 pt-4",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-400",children:[e.jsx(je,{size:16,className:"text-yellow-500 mt-0.5"}),e.jsx("span",{children:d.days})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-white",children:[e.jsx(Ie,{size:16,className:"text-yellow-500"}),e.jsx("span",{children:d.time})]})]})]},d.id))})]})]}),e.jsx("footer",{className:"bg-black text-white pt-16 pb-24 md:pb-8 border-t border-gray-800 relative z-10",children:e.jsxs("div",{className:"container mx-auto px-6 text-center",children:[e.jsxs("div",{className:"flex justify-center items-center gap-3 mb-6",children:[e.jsx("img",{src:de.LOGO,alt:"Logo",className:"w-10 h-10 rounded-full grayscale opacity-80"}),e.jsx("span",{className:"font-bold text-lg text-gray-400",children:"أكاديمية الشجاع للتايكوندو"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"© 2023 جميع الحقوق محفوظة."})]})}),e.jsx("button",{onClick:I,className:"fixed bottom-6 right-6 z-50 bg-[#25D366] text-white p-4 rounded-full shadow-2xl hover:bg-[#20bd5a] transition-transform hover:scale-110 flex items-center justify-center animate-bounce-slow border-4 border-white",title:"تواصل معنا عبر واتساب",children:e.jsx(ue,{size:28,fill:"white",className:"text-transparent"})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsx(J,{className:"w-full max-w-lg animate-fade-in border-t-8 border-yellow-500",title:"طلب تسجيل جديد",children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1 text-gray-600",children:"اسم الطالب الرباعي"}),e.jsx("input",{required:!0,className:"w-full border-2 border-gray-100 p-3 rounded-lg focus:border-yellow-500 focus:ring-0 outline-none transition-colors",placeholder:"الاسم الكامل",value:l.name,onChange:d=>b({...l,name:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1 text-gray-600",children:"تاريخ الميلاد"}),e.jsx("input",{type:"date",required:!0,className:"w-full border-2 border-gray-100 p-3 rounded-lg focus:border-yellow-500 focus:ring-0 outline-none transition-colors",value:l.dob,onChange:d=>b({...l,dob:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1 text-gray-600",children:"رقم هاتف ولي الأمر"}),e.jsx("input",{required:!0,className:"w-full border-2 border-gray-100 p-3 rounded-lg focus:border-yellow-500 focus:ring-0 outline-none transition-colors",placeholder:"079xxxxxxx",value:l.phone,onChange:d=>b({...l,phone:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1 text-gray-600",children:"العنوان"}),e.jsx("input",{required:!0,className:"w-full border-2 border-gray-100 p-3 rounded-lg focus:border-yellow-500 focus:ring-0 outline-none transition-colors",placeholder:"المنطقة - الشارع",value:l.address,onChange:d=>b({...l,address:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1 text-gray-600",children:"الفرع المطلوب"}),e.jsxs("select",{className:"w-full border-2 border-gray-100 p-3 rounded-lg focus:border-yellow-500 focus:ring-0 outline-none transition-colors bg-white",value:l.branch,onChange:d=>b({...l,branch:d.target.value}),children:[e.jsx("option",{value:se.SHAFA,children:se.SHAFA}),e.jsx("option",{value:se.ABU_NSEIR,children:se.ABU_NSEIR})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-4 border-t border-gray-100",children:[e.jsx(F,{variant:"ghost",className:"text-gray-500 hover:text-black",onClick:()=>c(!1),children:"إلغاء"}),e.jsx(F,{type:"submit",disabled:v,className:"bg-black text-white hover:bg-gray-800 px-8",children:v?"جاري الإرسال...":"إرسال الطلب"})]})]})})})]})},os=({setView:s,handleLogin:a,loginError:o})=>{const[x,r]=j.useState(""),[c,l]=j.useState(""),b=v=>{v.preventDefault(),a(x,c)};return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4 relative overflow-hidden",dir:"rtl",children:e.jsxs(J,{className:"w-full max-w-md relative z-10 border-t-4 border-yellow-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg p-2",children:e.jsx("img",{src:de.LOGO,alt:"Logo",className:"w-full h-full object-contain"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"تسجيل الدخول"})]}),o&&e.jsx("div",{className:"bg-red-100 text-red-700 p-2 rounded mb-4 text-sm text-center",children:o}),e.jsxs("form",{className:"space-y-5",onSubmit:b,children:[e.jsx("input",{className:"w-full border p-3 rounded-lg",type:"text",placeholder:"اسم المستخدم أو البريد الإلكتروني",value:x,onChange:v=>r(v.target.value),required:!0}),e.jsx("input",{className:"w-full border p-3 rounded-lg",type:"password",placeholder:"كلمة المرور",value:c,onChange:v=>l(v.target.value),required:!0}),e.jsx(F,{type:"submit",className:"w-full py-3 text-lg shadow-lg shadow-yellow-500/30",children:"دخول"})]}),e.jsx("div",{className:"mt-8 text-center border-t pt-4",children:e.jsxs("button",{onClick:()=>s("home"),className:"text-gray-500 hover:text-gray-800 text-sm font-medium flex items-center justify-center gap-2 w-full",children:[e.jsx(Ue,{size:16})," العودة للصفحة الرئيسية"]})})]})})},ds=({user:s,students:a,schedule:o,news:x,handleLogout:r})=>{const[c,l]=j.useState(new Date),b=h=>{const A=new Date(c);A.setMonth(A.getMonth()+h),l(A)},v=c.getFullYear(),w=c.getMonth(),p=new Date(v,w+1,0).getDate(),i=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],f=re("payments").data||[],g=a.find(h=>h.id===s.id)||s,m=a.filter(h=>h.familyId===s.familyId);let I=g.familyName||"عائلة";if(I.trim()==="عائلة"||I.trim().toLowerCase()==="family"){const h={};m.forEach(K=>{const _=K.name.trim().split(/\s+/);if(_.length>1){const W=_[_.length-1];h[W]=(h[W]||0)+1}});const A=Object.entries(h).sort((K,_)=>_[1]-K[1]);A.length>0&&(I=`عائلة ${A[0][0]}`)}const d=f.filter(h=>m.some(A=>A.id===h.studentId)).sort((h,A)=>new Date(A.date)-new Date(h.date)),$=[...new Set(m.map(h=>h.branch))],u=(x||[]).filter(h=>!h.branch||h.branch==="الكل"||$.includes(h.branch)).sort((h,A)=>new Date(A.createdAt||0)-new Date(h.createdAt||0)),S=h=>{if(!h)return"expired";const A=new Date,K=new Date(h);A.setHours(0,0,0,0),K.setHours(0,0,0,0);const _=K-A,W=Math.ceil(_/(1e3*60*60*24));return W<0?"expired":W<=7?"near_end":"active"},[M,L]=j.useState(!1),[O,E]=j.useState({username:"",password:""}),[n,k]=j.useState(!1),U=async h=>{if(h.preventDefault(),!O.username||!O.password)return alert("الرجاء تعبئة جميع الحقول");k(!0);try{const A=fe(ee,"artifacts",ie,"public","data","students",g.id);await ot(A,{username:O.username,password:O.password});const K={...s,username:O.username,password:O.password};localStorage.setItem("braveUser",JSON.stringify(K)),alert("تم تحديث بيانات الدخول بنجاح!"),L(!1)}catch(A){console.error(A),alert("حدث خطأ أثناء التحديث")}finally{k(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-100 font-sans text-right",dir:"rtl",children:[e.jsx("header",{className:"bg-black text-yellow-500 p-4 shadow-lg sticky top-0 z-40",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:de.LOGO,alt:"Logo",className:"w-10 h-10 bg-white rounded-full p-1"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"font-bold text-lg",children:["مرحباً ",I]}),e.jsx("p",{className:"text-xs text-gray-400",children:"بوابة العائلة"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:"secondary",onClick:()=>{E({username:g.username,password:g.password}),L(!0)},className:"text-sm bg-gray-800 hover:bg-gray-700 text-yellow-500 border border-gray-700",children:[e.jsx(Ge,{size:16})," إعدادات"]}),e.jsxs(F,{variant:"secondary",onClick:r,className:"text-sm",children:[e.jsx(vt,{size:16})," خروج"]})]})]})}),e.jsxs("div",{className:"container mx-auto p-4 md:p-8 max-w-5xl space-y-8",children:[u.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-r-4 border-yellow-500 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-white border-b border-yellow-100 flex items-center gap-2",children:[e.jsx("div",{className:"bg-yellow-500 text-white p-2 rounded-full shadow-sm animate-pulse",children:e.jsx(ke,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"آخر الأخبار والإعلانات"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u.slice(0,4).map(h=>e.jsxs("div",{className:"flex gap-4 items-start p-3 bg-gray-50 rounded-xl hover:shadow-md transition-all border border-gray-100",children:[h.image?e.jsx("img",{src:h.image,alt:"News",className:"w-20 h-20 object-cover rounded-lg border border-gray-200"}):e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400",children:e.jsx(ke,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 mb-1",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 leading-relaxed",children:h.desc}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("span",{className:"text-[10px] bg-white border border-gray-200 px-2 py-0.5 rounded-full text-gray-500",children:h.branch||"عام"})})]})]},h.id))})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 text-white p-6 rounded-2xl shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(qe,{className:"text-yellow-500"})," مواعيد الحصص"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:o&&o.length>0?o.map(h=>e.jsxs("div",{className:"bg-white/10 p-4 rounded-lg",children:[e.jsx("p",{className:"font-bold text-yellow-400 mb-1",children:h.level}),e.jsxs("p",{className:"text-sm",children:[h.days," | ",h.time]})]},h.id)):e.jsx("p",{className:"text-gray-400",children:"لا يوجد جدول حصص معلن حالياً"})})]}),e.jsx(J,{title:"كشف الحساب (الدفعات السابقة)",children:d.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"الطالب"}),e.jsx("th",{className:"p-3",children:"البيان"}),e.jsx("th",{className:"p-3",children:"المبلغ"})]})}),e.jsx("tbody",{children:d.map(h=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-3 text-gray-500 font-mono",children:h.date}),e.jsx("td",{className:"p-3 font-bold text-gray-800",children:h.name}),e.jsxs("td",{className:"p-3 text-gray-700",children:[h.reason," ",h.details&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["(",h.details,")"]})]}),e.jsxs("td",{className:"p-3 text-green-600 font-bold",dir:"ltr",children:[h.amount," JD"]})]},h.id))})]})}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"لا توجد دفعات مسجلة"})}),m.map(h=>e.jsxs(J,{className:"mb-8 border-t-4 border-yellow-500",title:h.name,children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-1",children:"الحزام الحالي"}),e.jsx("p",{className:"font-bold text-xl",children:h.belt})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-1",children:"حالة الاشتراك"}),e.jsx(Le,{status:S(h.subEnd)}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ينتهي: ",h.subEnd]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-1",children:"الرصيد المستحق"}),e.jsxs("p",{className:`font-bold text-xl ${h.balance>0?"text-red-600":"text-green-600"}`,children:[h.balance," JOD"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-1",children:"الفرع"}),e.jsx("p",{className:"font-bold text-lg",children:h.branch})]})]}),h.notes&&h.notes.length>0&&e.jsxs("div",{className:"mb-6 bg-blue-50 p-4 rounded-xl border border-blue-100",children:[e.jsx("h4",{className:"font-bold text-blue-800 text-sm mb-2",children:"ملاحظات الإدارة:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-900",children:h.notes.map(A=>e.jsxs("li",{children:[A.text," (",A.date,")"]},A.id))})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-gray-700",children:["سجل الحضور: ",i[w]," ",v]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"ghost",onClick:()=>b(-1),children:e.jsx(Ue,{size:16})}),e.jsx(F,{variant:"ghost",onClick:()=>b(1),children:e.jsx(Ke,{size:16})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center md:justify-start",children:[...Array(p)].map((A,K)=>{const _=K+1,W=`${v}-${String(w+1).padStart(2,"0")}-${String(_).padStart(2,"0")}`,y=h.attendance&&h.attendance[W];return e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center text-xs font-bold border ${y?"bg-green-500 text-white":"bg-gray-100 text-gray-400"}`,children:_},_)})})]})]},h.id))]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs(J,{className:"w-full max-w-sm relative bg-white rounded-2xl shadow-2xl",children:[e.jsx("button",{onClick:()=>L(!1),className:"absolute top-4 left-4 text-gray-400 hover:text-black transition-colors",children:e.jsx(xe,{size:24})}),e.jsx("h3",{className:"text-xl font-bold mb-6 text-center text-gray-800",children:"تحديث بيانات الدخول"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-600 mb-1",children:"اسم المستخدم الجديد"}),e.jsx("input",{className:"w-full border-2 border-gray-200 p-3 rounded-xl focus:border-yellow-500 outline-none transition-colors font-mono text-left dir-ltr",value:O.username,onChange:h=>E({...O,username:h.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-600 mb-1",children:"كلمة المرور الجديدة"}),e.jsx("input",{className:"w-full border-2 border-gray-200 p-3 rounded-xl focus:border-yellow-500 outline-none transition-colors font-mono text-left dir-ltr",value:O.password,onChange:h=>E({...O,password:h.target.value}),required:!0})]}),e.jsx("div",{className:"pt-4",children:e.jsx(F,{type:"submit",disabled:n,className:"w-full py-3 bg-yellow-500 text-black font-bold hover:bg-yellow-400 transition-colors shadow-lg shadow-yellow-500/20",children:n?"جاري الحفظ...":"حفظ التغييرات"})})]})]})})]})},is=()=>{const[s,a]=j.useState(new Date),[o,x]=j.useState("note"),[r,c]=j.useState([]),[l,b]=j.useState(!1),[v,w]=j.useState(!1),[p,i]=j.useState(null),[N,f]=j.useState({text:"",amount:"",type:"note",transactionType:"expense"}),g=`${s.getMonth()+1}-${s.getFullYear()}`,m=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];j.useEffect(()=>{I()},[g]);const I=async()=>{b(!0);try{const n=ze(he(ee,"artifacts",ie,"public","data","admin_notes"),Se("monthKey","==",g),Lt("createdAt","desc")),U=(await at(n)).docs.map(h=>({id:h.id,...h.data()}));c(U)}catch(n){console.error("Error fetching items:",n)}b(!1)},d=async n=>{if(n.preventDefault(),!!N.text)try{const k={...N,monthKey:g,createdAt:p?N.createdAt:new Date().toISOString(),date:p?N.date:new Date().toLocaleDateString("ar-JO"),lastUpdated:new Date().toISOString()};p?await ot(fe(ee,"artifacts",ie,"public","data","admin_notes",p),k):await Re(he(ee,"artifacts",ie,"public","data","admin_notes"),k),M(),I()}catch(k){console.error("Error saving item:",k),alert("حدث خطأ أثناء الحفظ.")}},$=async n=>{if(confirm("هل أنت متأكد من الحذف نهائياً؟"))try{await nt(fe(ee,"artifacts",ie,"public","data","admin_notes",n)),c(r.filter(k=>k.id!==n))}catch(k){console.error("Error deleting:",k)}},u=n=>{i(null),f({text:"",amount:"",type:n,transactionType:"expense"}),w(!0)},S=n=>{i(n.id),f({...n}),w(!0)},M=()=>{w(!1),i(null)},L=n=>{const k=new Date(s);k.setMonth(k.getMonth()+n),a(k)},O=j.useMemo(()=>{const n=r.filter(h=>h.type==="account"),k=n.filter(h=>h.transactionType==="income").reduce((h,A)=>h+Number(A.amount||0),0),U=n.filter(h=>h.transactionType==="expense").reduce((h,A)=>h+Number(A.amount||0),0);return{income:k,expense:U,total:k-U}},[r]),E=()=>{const n=window.open("","PRINT","height=800,width=1000"),k=r.filter(A=>A.type==="note"),U=r.filter(A=>A.type==="account"),h=`
      <!DOCTYPE html>
      <html lang="ar" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>تقرير الإدارة - ${m[s.getMonth()]}</title>
        <style>
          body { font-family: sans-serif; padding: 20px; }
          .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
          th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
          th { background: #f0f0f0; }
          .income { color: green; }
          .expense { color: red; }
          .total-box { margin-top: 20px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; font-weight: bold; display: flex; justify-content: space-around; }
        </style>
      </head>
      <body>
        <div class="header">
          <h2>سجل الإدارة والمالية</h2>
          <p>${m[s.getMonth()]} ${s.getFullYear()}</p>
        </div>

        <h3>أولاً: الحركات المالية</h3>
        <table>
          <thead><tr><th>التاريخ</th><th>النوع</th><th>البيان</th><th>المبلغ</th></tr></thead>
          <tbody>
            ${U.map(A=>`
              <tr>
                <td>${A.date}</td>
                <td>${A.transactionType==="income"?"إيراد":"مصروف"}</td>
                <td>${A.text}</td>
                <td class="${A.transactionType==="income"?"income":"expense"}">${A.amount}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
        <div class="total-box">
           <span>دخل: ${O.income}</span>
           <span>صرف: ${O.expense}</span>
           <span>صافي: ${O.total}</span>
        </div>

        <h3>ثانياً: الملاحظات</h3>
        <ul>
          ${k.map(A=>`<li><b>${A.date}:</b> ${A.text}</li>`).join("")}
        </ul>
      </body>
      </html>
    `;n.document.write(h),n.document.close(),n.print()};return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[e.jsxs("div",{className:"bg-white p-4 rounded-3xl shadow-sm border border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 p-2 rounded-2xl border border-gray-100",children:[e.jsx(F,{variant:"ghost",onClick:()=>L(-1),className:"hover:bg-white hover:shadow-sm rounded-xl",children:e.jsx(Ue,{})}),e.jsxs("div",{className:"text-center min-w-[160px]",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-800",children:m[s.getMonth()]}),e.jsx("p",{className:"text-xs font-bold text-gray-400",children:s.getFullYear()})]}),e.jsx(F,{variant:"ghost",onClick:()=>L(1),className:"hover:bg-white hover:shadow-sm rounded-xl",children:e.jsx(Ke,{})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{onClick:()=>u("note"),className:"bg-yellow-100 text-yellow-700 hover:bg-yellow-200 border-2 border-yellow-200 gap-2 font-bold shadow-sm rounded-xl",children:[e.jsx(Qe,{size:18})," إضافة ملاحظة"]}),e.jsxs(F,{onClick:()=>u("account"),className:"bg-black text-white hover:bg-gray-800 gap-2 font-bold shadow-lg shadow-gray-200 rounded-xl",children:[e.jsx(We,{size:18})," حركة مالية"]}),e.jsx(F,{onClick:E,variant:"outline",className:"gap-2 border-gray-200 text-gray-500 hover:text-black rounded-xl",children:e.jsx(be,{size:18})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-gray-100 shadow-sm flex items-center justify-between group hover:border-green-200 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-green-600 text-xs font-bold mb-1 block",children:"الدخل الشهري"}),e.jsxs("span",{className:"text-2xl font-black text-gray-800",children:[O.income," ",e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"JD"})]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-50 flex items-center justify-center text-green-600 group-hover:scale-110 transition-transform",children:e.jsx(Ce,{size:20})})]}),e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-gray-100 shadow-sm flex items-center justify-between group hover:border-red-200 transition-all",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600 text-xs font-bold mb-1 block",children:"المصروفات"}),e.jsxs("span",{className:"text-2xl font-black text-gray-800",children:[O.expense," ",e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"JD"})]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-50 flex items-center justify-center text-red-600 group-hover:scale-110 transition-transform",children:e.jsx(lt,{size:20})})]}),e.jsxs("div",{className:"bg-blue-600 p-5 rounded-3xl shadow-lg shadow-blue-200 flex items-center justify-between text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute -right-4 -top-4 w-20 h-20 bg-white/10 rounded-full"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-100 text-xs font-bold mb-1 block",children:"الصافي النهائي"}),e.jsxs("span",{className:"text-3xl font-black",children:[O.total," ",e.jsx("span",{className:"text-base font-medium opacity-70",children:"JD"})]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(Gt,{size:20})})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-gray-100 min-h-[500px] overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-100 p-2 gap-2 bg-gray-50/50",children:[e.jsxs("button",{onClick:()=>x("note"),className:`flex-1 py-3 rounded-2xl font-bold text-sm transition-all flex items-center justify-center gap-2
              ${o==="note"?"bg-white shadow-sm text-yellow-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(Qe,{size:18}),"الملاحظات (",r.filter(n=>n.type==="note").length,")"]}),e.jsxs("button",{onClick:()=>x("account"),className:`flex-1 py-3 rounded-2xl font-bold text-sm transition-all flex items-center justify-center gap-2
              ${o==="account"?"bg-white shadow-sm text-blue-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(We,{size:18}),"سجل الحسابات (",r.filter(n=>n.type==="account").length,")"]})]}),e.jsx("div",{className:"p-6",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-300",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mb-4"}),e.jsx("p",{children:"جاري التحميل..."})]}):r.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-300",children:[e.jsx(Qe,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا يوجد بيانات لعرضها في هذا القسم"})]}):e.jsxs(e.Fragment,{children:[o==="note"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:r.filter(n=>n.type==="note").map(n=>e.jsxs("div",{className:"p-5 rounded-2xl bg-yellow-50 border border-yellow-100 relative group transition-all hover:shadow-md hover:-translate-y-1",children:[e.jsx("span",{className:"text-[10px] text-yellow-600 font-bold mb-2 block opacity-70",children:n.date}),e.jsx("p",{className:"text-gray-800 font-bold whitespace-pre-wrap leading-relaxed text-sm",children:n.text}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/50 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>S(n),className:"p-1.5 text-blue-600 hover:bg-blue-100 rounded-md",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:()=>$(n.id),className:"p-1.5 text-red-600 hover:bg-red-100 rounded-md",children:e.jsx(ne,{size:14})})]})]},n.id))}),o==="account"&&e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-100",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 text-xs font-bold uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 rounded-tr-xl",children:"التاريخ"}),e.jsx("th",{className:"px-6 py-4",children:"النوع"}),e.jsx("th",{className:"px-6 py-4 w-1/2",children:"البيان / الوصف"}),e.jsx("th",{className:"px-6 py-4",children:"المبلغ"}),e.jsx("th",{className:"px-6 py-4 rounded-tl-xl text-center",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:r.filter(n=>n.type==="account").map(n=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-600",children:n.date}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold ${n.transactionType==="income"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[n.transactionType==="income"?e.jsx(xt,{size:12}):e.jsx(mt,{size:12}),n.transactionType==="income"?"إيراد":"مصروف"]})}),e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-800",children:n.text}),e.jsxs("td",{className:`px-6 py-4 text-sm font-black dir-ltr text-right ${n.transactionType==="income"?"text-green-600":"text-red-600"}`,children:[n.amount," JD"]}),e.jsxs("td",{className:"px-6 py-4 flex justify-center gap-2 opacity-50 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>S(n),className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>$(n.id),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx(ne,{size:16})})]})]},n.id))})]})})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-fade-in",onClick:M,children:e.jsxs("div",{className:`rounded-3xl w-full max-w-md shadow-2xl transform transition-all overflow-hidden ${N.type==="note"?"bg-[#fffbeb]":"bg-white"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:`px-6 py-5 border-b flex justify-between items-center ${N.type==="note"?"border-yellow-200 bg-yellow-50":"border-gray-100 bg-gray-50"}`,children:[e.jsx("h3",{className:`text-lg font-black flex items-center gap-2 ${N.type==="note"?"text-yellow-800":"text-gray-800"}`,children:p?"تعديل السجل":N.type==="note"?"📝 ملاحظة جديدة":"💰 حركة مالية"}),e.jsx("button",{onClick:M,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/5 transition-colors",children:e.jsx(xe,{size:20})})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-5",children:[N.type==="account"&&e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl",children:[e.jsxs("button",{type:"button",onClick:()=>f({...N,transactionType:"expense"}),className:`flex-1 py-3 rounded-lg font-bold text-sm transition-all flex items-center justify-center gap-2 
                        ${N.transactionType==="expense"?"bg-white text-red-600 shadow-sm":"text-gray-500"}`,children:[e.jsx(mt,{size:16})," مصروف"]}),e.jsxs("button",{type:"button",onClick:()=>f({...N,transactionType:"income"}),className:`flex-1 py-3 rounded-lg font-bold text-sm transition-all flex items-center justify-center gap-2 
                        ${N.transactionType==="income"?"bg-white text-green-600 shadow-sm":"text-gray-500"}`,children:[e.jsx(xt,{size:16})," إيراد"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-2",children:N.type==="note"?"محتوى الملاحظة":"الوصف / البيان"}),e.jsx("textarea",{className:`w-full p-4 rounded-2xl outline-none font-bold text-gray-700 resize-none h-32 transition-colors border-2
                       ${N.type==="note"?"bg-white border-yellow-200 focus:border-yellow-400 placeholder-yellow-300/50":"bg-gray-50 border-gray-100 focus:bg-white focus:border-blue-500"}`,placeholder:"اكتب هنا...",value:N.text,onChange:n=>f({...N,text:n.target.value}),autoFocus:!0})]}),N.type==="account"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-2",children:"المبلغ (JD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"w-full bg-gray-50 border-2 border-gray-100 p-4 pl-12 rounded-2xl focus:border-blue-500 focus:bg-white outline-none font-black text-xl dir-ltr",value:N.amount,onChange:n=>f({...N,amount:n.target.value}),placeholder:"0.00"}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-bold",children:"JD"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-50",children:[e.jsx(F,{variant:"ghost",onClick:M,type:"button",className:"flex-1 rounded-xl",children:"إلغاء"}),e.jsxs(F,{type:"submit",className:`flex-[2] rounded-xl py-3 shadow-lg ${N.type==="note"?"bg-yellow-500 text-black hover:bg-yellow-600":"bg-black text-white hover:bg-gray-800"}`,children:[e.jsx(wt,{size:18,className:"ml-2"})," حفظ"]})]})]})]})})]})},cs=({user:s,selectedBranch:a,branchStudents:o,netProfit:x,totalAttendance:r,expiredCount:c,activeStudentsCount:l,nearEndCount:b,totalStudents:v,activityLogs:w=[]})=>{const p=i=>{if(!i)return{date:"-",time:"-"};const N=new Date(i);return{date:N.toLocaleDateString("ar-JO"),time:N.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}};return e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl p-8 text-white shadow-lg flex justify-between items-center relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["مرحباً بك يا ",s.name,"! 👋"]}),e.jsxs("p",{className:"opacity-90",children:["نظرة سريعة على أداء فرع ",a]})]}),e.jsxs("div",{className:"relative z-10 bg-white/20 p-4 rounded-xl backdrop-blur-sm text-center",children:[e.jsx("span",{className:"block text-4xl font-bold",children:new Date().getDate()}),e.jsx("span",{className:"uppercase text-sm tracking-wider",children:new Date().toLocaleString("en-us",{month:"short"})})]}),e.jsx("div",{className:"absolute right-0 top-0 opacity-10 transform translate-x-10 -translate-y-10",children:e.jsx(Nt,{size:200})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(J,{className:"border-l-4 border-blue-500 transform hover:-translate-y-1 transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"إجمالي الطلاب"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:o.length})]}),e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(Ne,{className:"text-blue-600",size:24})})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(Ee,{size:18,className:"text-green-500"})," ",e.jsx("span",{className:"text-green-500 font-bold",children:"+100"})," هذا الشهر"]})]}),e.jsx(J,{className:"border-l-4 border-green-500 transform hover:-translate-y-1 transition-transform",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"صافي الأرباح"}),e.jsxs("h3",{className:"text-3xl font-bold text-gray-800",children:[x," ",e.jsx("span",{className:"text-sm text-gray-400",children:"JOD"})]})]}),e.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:e.jsx(Ce,{className:"text-green-600",size:24})})]})}),e.jsx(J,{className:"border-l-4 border-purple-500 transform hover:-translate-y-1 transition-transform",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"حضور الشهر"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:r})]}),e.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:e.jsx(Ie,{className:"text-purple-600",size:24})})]})}),e.jsx(J,{className:"border-l-4 border-red-500 transform hover:-translate-y-1 transition-transform",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"اشتراكات منتهية"}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:c})]}),e.jsx("div",{className:"bg-red-100 p-2 rounded-lg",children:e.jsx(Ht,{className:"text-red-600",size:24})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(J,{title:"توزيع الاشتراكات",className:"lg:col-span-1",children:[e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx("div",{className:"relative w-48 h-48 rounded-full bg-gray-100 border-8 border-white shadow-inner flex items-center justify-center",style:{background:`conic-gradient(#22c55e 0% ${l/v*100||0}%, #eab308 ${l/v*100||0}% ${(l+b)/v*100||0}%, #ef4444 ${(l+b)/v*100||0}% 100%)`},children:e.jsxs("div",{className:"w-32 h-32 bg-white rounded-full flex flex-col items-center justify-center z-10 shadow-sm",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-800",children:v}),e.jsx("span",{className:"text-xs text-gray-400",children:"طالب كلي"})]})})}),e.jsxs("div",{className:"flex justify-around text-xs mt-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"})," فعال (",l,")"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"})," قارب (",b,")"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"})," منتهي (",c,")"]})]})]}),e.jsx(J,{title:"سجل النشاطات الأخير (Live Log)",className:"lg:col-span-2",children:e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:w.length===0?e.jsxs("div",{className:"text-center text-gray-400 py-10 flex flex-col items-center",children:[e.jsx(Jt,{size:32,className:"mb-2 opacity-30"}),e.jsx("p",{children:"لا يوجد نشاطات مسجلة حديثاً"})]}):w.map((i,N)=>{const{date:f,time:g}=p(i.timestamp);return e.jsxs("div",{className:"flex gap-4 items-start p-3 hover:bg-gray-50 rounded-xl transition border border-gray-100 shadow-sm bg-white",children:[e.jsx("div",{className:"bg-blue-50 text-blue-600 p-2 rounded-full mt-1 shrink-0",children:e.jsx(Ve,{size:18})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:i.action}),e.jsxs("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full font-mono flex items-center gap-1",children:[e.jsx(qe,{size:10})," ",g]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.details}),e.jsxs("div",{className:"flex justify-between items-center mt-2 border-t border-gray-50 pt-2",children:[e.jsxs("p",{className:"text-[10px] font-bold text-blue-800",children:["بواسطة: ",i.performedBy]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:f})]})]})]},N)})})})]})]})},xs=()=>{const a=`student${Math.floor(1e3+Math.random()*9e3)}`,o="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";let x="";for(let r=0;r<8;r++)x+=o.charAt(Math.floor(Math.random()*o.length));return{username:a,password:x}},De=s=>{if(!s)return"-";const a=new Date(s);if(isNaN(a.getTime()))return s;const o=String(a.getDate()).padStart(2,"0"),x=String(a.getMonth()+1).padStart(2,"0"),r=a.getFullYear();return`${o}/${x}/${r}`},et=s=>{if(!s)return"expired";const a=new Date,o=new Date(s);a.setHours(0,0,0,0),o.setHours(0,0,0,0);const x=o-a,r=Math.ceil(x/(1e3*60*60*24));return r<0?"expired":r<=7?"near_end":"active"},pt=s=>{if(!s)return!1;const a=new Date,o=new Date(s),x=Math.abs(a-o);return Math.ceil(x/(1e3*60*60*24))<=7},Pe=({children:s,onClose:a})=>typeof document>"u"?null:Be.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] overflow-y-auto",role:"dialog",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:a}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-0",children:e.jsx("div",{className:"relative transform overflow-hidden rounded-2xl text-right shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-2xl bg-white",onClick:o=>o.stopPropagation(),children:s})})]}),document.body),ms=({isOpen:s,onClose:a,groups:o,allStudents:x,onSend:r})=>{const[c,l]=j.useState("all"),[b,v]=j.useState(""),[w,p]=j.useState([]),[i,N]=j.useState(""),[f,g]=j.useState(""),[m,I]=j.useState(!1);if(!s)return null;const d=x.filter(S=>S.name.toLowerCase().includes(i.toLowerCase())),$=S=>{w.includes(S)?p(M=>M.filter(L=>L!==S)):p(M=>[...M,S])},u=async()=>{if(!f.trim())return alert("الرجاء كتابة الرسالة");if(c==="custom"&&w.length===0)return alert("الرجاء اختيار طالب واحد على الأقل");I(!0),await r(c,b,f,w),I(!1),g(""),p([]),a()};return e.jsx(Pe,{onClose:a,children:e.jsxs("div",{className:"p-6 max-h-[80vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-blue-700",children:[e.jsx(ke,{size:24})," إرسال تعميم / إعلان"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"لمن تريد إرسال الإعلان؟"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsx("input",{type:"radio",name:"target",value:"all",checked:c==="all",onChange:()=>l("all")}),e.jsx("span",{children:"الكل (جميع الطلاب)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsx("input",{type:"radio",name:"target",value:"group",checked:c==="group",onChange:()=>{l("group"),o.length>0&&v(o[0])}}),e.jsx("span",{children:"فترة / مجموعة محددة"})]}),c==="group"&&e.jsx("div",{className:"mr-6 mb-2",children:e.jsx("select",{className:"w-full border-2 border-gray-200 p-2 rounded-xl outline-none",value:b,onChange:S=>v(S.target.value),children:o.map((S,M)=>e.jsx("option",{value:S,children:S},M))})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsx("input",{type:"radio",name:"target",value:"custom",checked:c==="custom",onChange:()=>l("custom")}),e.jsx("span",{children:"تحديد طلاب (يدوياً)"})]}),c==="custom"&&e.jsxs("div",{className:"mr-6 p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("input",{className:"w-full border-b border-gray-100 p-2 mb-2 text-sm outline-none",placeholder:"ابحث عن طالب...",value:i,onChange:S=>N(S.target.value)}),e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1 custom-scrollbar",children:d.map(S=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w.includes(S.id),onChange:()=>$(S.id)}),e.jsx("span",{className:"text-sm",children:S.name})]},S.id))}),e.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-bold",children:["تم اختيار: ",w.length," طالب"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"نص الإعلان"}),e.jsx("textarea",{className:"w-full border-2 border-gray-200 p-3 rounded-xl outline-none h-32 focus:border-blue-500",placeholder:"اكتب الإعلان هنا... (سيظهر في صفحة الطلاب)",value:f,onChange:S=>g(S.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(F,{variant:"ghost",onClick:a,children:"إلغاء"}),e.jsx(F,{onClick:u,disabled:m,className:"bg-blue-600 text-white hover:bg-blue-700",children:m?"جاري الإرسال...":"نشر الإعلان"})]})]})]})})},hs=({student:s,onClose:a,onSave:o})=>{const[x,r]=j.useState("private"),[c,l]=j.useState(""),b=()=>{if(!c.trim())return;const p={id:Date.now().toString(),text:c,date:De(new Date),timestamp:new Date().toISOString()};o(s.id,x,"add",p),l("")},v=(p,i)=>{confirm("حذف الملاحظة؟")&&o(s.id,x,"delete",{id:p,isLegacy:i})},w=j.useMemo(()=>{if(x==="private"){let p=s.internalNotes||[];return s.note&&s.note.trim()!==""&&(p=[...p,{id:"legacy_note",text:s.note,date:"سجل قديم",isLegacy:!0}]),p}else return s.notes||[]},[s,x]);return e.jsx(Pe,{onClose:a,children:e.jsxs("div",{className:"p-0 overflow-hidden flex flex-col h-[500px]",children:[e.jsxs("div",{className:`p-4 text-white flex justify-between items-center ${x==="private"?"bg-red-600":"bg-blue-600"}`,children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[x==="private"?e.jsx(pe,{size:20}):e.jsx(Ze,{size:20}),x==="private"?`ملاحظات خاصة: ${s.name}`:`إعلانات للطالب: ${s.name}`]}),e.jsx("button",{onClick:a,children:e.jsx(xe,{size:20})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>r("private"),className:`flex-1 py-3 font-bold text-sm flex items-center justify-center gap-2 ${x==="private"?"text-red-600 border-b-2 border-red-600 bg-red-50":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(pe,{size:16})," ملاحظات خاصة (للإدارة)"]}),e.jsxs("button",{onClick:()=>r("public"),className:`flex-1 py-3 font-bold text-sm flex items-center justify-center gap-2 ${x==="public"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(Ze,{size:16})," إعلانات (للطالب)"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:w.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[x==="private"?e.jsx(pe,{size:48,className:"mb-2 opacity-20"}):e.jsx(Ze,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{children:"لا يوجد ملاحظات مسجلة"})]}):e.jsx("div",{className:"space-y-3",children:w.map((p,i)=>e.jsxs("div",{className:"bg-white p-3 rounded-xl border border-gray-200 shadow-sm relative group",children:[e.jsx("p",{className:"text-gray-800 text-sm whitespace-pre-wrap",children:p.text}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 bg-gray-100 px-2 py-1 rounded-full",children:p.date}),p.isLegacy&&e.jsx("span",{className:"text-[10px] text-red-600 bg-red-100 px-2 py-1 rounded-full font-bold",children:"قديم"})]}),e.jsx("button",{onClick:()=>v(p.id,p.isLegacy),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(ne,{size:16})})]})]},p.id||i))})}),e.jsx("div",{className:"p-4 bg-white border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border-2 border-gray-200 rounded-xl px-4 py-2 focus:outline-none focus:border-yellow-500",placeholder:x==="private"?"اكتب ملاحظة سرية...":"اكتب إعلاناً للطالب...",value:c,onChange:p=>l(p.target.value),onKeyDown:p=>p.key==="Enter"&&b()}),e.jsx(F,{onClick:b,className:x==="private"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700",children:e.jsx($e,{size:18})})]})})]})})},bs=({student:s,onClose:a,onSave:o})=>{const[x,r]=j.useState(s.subEnd||new Date().toISOString().split("T")[0]),c=l=>{const b=new Date(x);b.setMonth(b.getMonth()+l),r(b.toISOString().split("T")[0])};return e.jsx(Pe,{onClose:a,children:e.jsxs("div",{className:"p-6 text-right",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 text-green-700 flex items-center gap-2",children:[e.jsx(rt,{size:24})," تجديد اشتراك: ",s.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"تاريخ انتهاء الاشتراك الجديد"}),e.jsx("input",{type:"date",className:"w-full border-2 border-green-100 focus:border-green-500 p-3 rounded-xl outline-none text-lg font-bold text-center bg-green-50/20",value:x,onChange:l=>r(l.target.value)})]}),e.jsx("label",{className:"block text-xs font-bold text-gray-400 mb-2",children:"إضافة سريعة:"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>c(1),className:"flex-1 bg-white hover:bg-green-50 text-green-700 border border-green-200 py-3 rounded-xl font-bold text-sm transition shadow-sm hover:shadow-md",children:"+ شهر"}),e.jsx("button",{onClick:()=>c(2),className:"flex-1 bg-white hover:bg-green-50 text-green-700 border border-green-200 py-3 rounded-xl font-bold text-sm transition shadow-sm hover:shadow-md",children:"+ شهرين"}),e.jsx("button",{onClick:()=>c(3),className:"flex-1 bg-white hover:bg-green-50 text-green-700 border border-green-200 py-3 rounded-xl font-bold text-sm transition shadow-sm hover:shadow-md",children:"+ 3 شهور"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx(F,{variant:"ghost",onClick:a,children:"إلغاء"}),e.jsx(F,{onClick:()=>o(s.id,x),className:"flex-1 bg-green-600 text-white hover:bg-green-700 shadow-lg shadow-green-600/20",children:"حفظ التجديد"})]})]})})},gs=({students:s,studentsCollection:a,archiveCollection:o,selectedBranch:x,logActivity:r,groups:c})=>{const[l,b]=j.useState(""),[v,w]=j.useState("all"),[p,i]=j.useState("joinDateDesc"),[N,f]=j.useState(!1),[g,m]=j.useState(null),[I,d]=j.useState(null),[$,u]=j.useState(null),[S,M]=j.useState(!1),[L,O]=j.useState(null),E=j.useMemo(()=>c?c.map(t=>t.name):[],[c]),n={name:"",phone:"",belt:"أبيض",group:"",joinDate:new Date().toISOString().split("T")[0],dob:"",address:"",balance:0,subEnd:"",username:"",password:""},[k,U]=j.useState(n),[h,A]=j.useState("new"),K=j.useMemo(()=>{const t={};return s.forEach(C=>{if(C.familyId&&C.familyId!=="new"){t[C.familyId]||(t[C.familyId]={name:C.familyName,members:[],lastNames:{}});const P=C.name.trim().split(/\s+/),H=P[0],Y=P.length>1?P[P.length-1]:"";t[C.familyId].members.length<3&&t[C.familyId].members.push(H),Y&&(t[C.familyId].lastNames[Y]=(t[C.familyId].lastNames[Y]||0)+1)}}),Object.entries(t).map(([C,P])=>{let H=P.name||"عائلة";if(!H||H.trim()==="عائلة"||H.trim().toLowerCase()==="family"){const Q=Object.entries(P.lastNames);Q.length>0&&(H=`عائلة ${Q.sort((te,oe)=>oe[1]-te[1])[0][0]}`)}return{id:C,displayName:`${H} (يشمل: ${P.members.join("، ")}...)`}})},[s]),_=j.useMemo(()=>{let t=[...s];if(l){const C=l.toLowerCase();t=t.filter(P=>P.name.toLowerCase().includes(C)||P.phone.includes(C)||P.username.toLowerCase().includes(C))}return v!=="all"&&(t=t.filter(C=>et(C.subEnd)===v)),t.sort((C,P)=>{switch(p){case"joinDateDesc":return new Date(P.joinDate||0)-new Date(C.joinDate||0);case"joinDateAsc":return new Date(C.joinDate||0)-new Date(P.joinDate||0);case"beltDesc":return V.indexOf(P.belt)-V.indexOf(C.belt);case"beltAsc":return V.indexOf(C.belt)-V.indexOf(P.belt);case"balanceDesc":return P.balance-C.balance;default:return 0}}),t},[s,l,v,p]),W=async t=>{var me;t.preventDefault();let C=k.username,P=k.password;if(!C||!P){const z=xs();C=z.username,P=z.password}let H,Y;if(h==="new")H=Math.floor(Date.now()/1e3),Y=`عائلة ${k.name.trim().split(/\s+/).pop()}`;else{H=parseInt(h);const z=K.find(Z=>Z.id===h.toString());z?Y=z.displayName.split(" (")[0]:Y=((me=s.find(Z=>Z.familyId===H))==null?void 0:me.familyName)||"عائلة"}let Q=k.subEnd;if(!Q){const z=new Date(k.joinDate||new Date),Z=new Date(z);Z.setMonth(Z.getMonth()+1),Q=Z.toISOString().split("T")[0]}const B=k.group||(E.length>0?E[0]:"الكل"),te={...k,branch:x,status:"active",subEnd:Q,notes:[],internalNotes:[],attendance:{},familyId:H,familyName:Y,customOrder:Date.now(),group:B,username:C,password:P};await a.add(te)&&(r&&r("إضافة طالب",`تم إضافة الطالب ${te.name}`),d({name:te.name,username:C,password:P,phone:te.phone}),G())},y=t=>{m(t),U({name:t.name,phone:t.phone,belt:t.belt,group:t.group||"",joinDate:t.joinDate,dob:t.dob,address:t.address||"",subEnd:t.subEnd,balance:t.balance,username:t.username,password:t.password}),A(t.familyId),f(!0)},G=()=>{f(!1),m(null),U(n),A("new")},X=async t=>{t.preventDefault(),await a.update(g.id,k),G()},ae=async t=>{const C=V.indexOf(t.belt);C<V.length-1&&await a.update(t.id,{belt:V[C+1]})},le=async t=>{confirm(`هل أنت متأكد من أرشفة الطالب ${t.name}؟`)&&(await o.add({...t,archivedAt:new Date().toISOString().split("T")[0],originalId:t.id}),await a.remove(t.id),r&&r("أرشفة",`أرشفة الطالب ${t.name}`))},ce=async(t,C,P,H)=>{const Y=s.find(oe=>oe.id===t);if(!Y)return;if(P==="delete"&&H.isLegacy){await a.update(t,{note:""});return}const Q=C==="private"?"internalNotes":"notes";let B=Y[Q]||[],te;P==="add"?te=[H,...B]:te=B.filter(oe=>oe.id!==H.id),await a.update(t,{[Q]:te})},D=async(t,C,P,H=[])=>{let Y=[];if(t==="all"?Y=s:t==="group"?Y=s.filter(B=>B.group===C):t==="custom"&&(Y=s.filter(B=>H.includes(B.id))),Y.length===0)return alert("لا يوجد طلاب مستهدفين");if(!confirm(`سيتم إرسال الإعلان لـ ${Y.length} طالب. هل أنت متأكد؟`))return;const Q={id:Date.now().toString(),text:P,date:De(new Date),timestamp:new Date().toISOString()};try{const B=Pt(ee);let te=0;Y.forEach(oe=>{const me=fe(ee,"artifacts",ie,"public","data","students",oe.id),z=oe.notes||[];B.update(me,{notes:[Q,...z]}),te++}),te>0&&(await B.commit(),alert("تم نشر الإعلان بنجاح!"))}catch(B){console.error("Broadcast Error:",B),alert("حدث خطأ أثناء النشر الجماعي. تأكد من الصلاحيات.")}},R=async(t,C)=>{await a.update(t,{subEnd:C}),r&&L&&r("تجديد اشتراك",`تجديد اشتراك للطالب ${L.name} (تاريخ جديد: ${De(C)})`),O(null)},q=t=>{if(!t)return;let C=t.replace(/\D/g,"");C.startsWith("0")&&(C=C.substring(1)),window.open(`https://wa.me/962${C}`,"_blank")},T=t=>{if(!t.phone)return;let C=t.phone.replace(/\D/g,"");C.startsWith("0")&&(C=C.substring(1));const P=`مرحباً ${t.name} 🔥

أهلاً بك في أكاديمية الشجاع للتايكواندو !
إليك بيانات الدخول الخاصة بك بالموقع :

👤 اسم المستخدم: ${t.username}
🔑 كلمة المرور: ${t.password}

موقعنا الالكتروني :
https://bravetkd.bar/

نتمنى لك التوفيق يا بطل! 🥋

📍 فروعنا :
✅ الفرع الأول: شفابدران – شارع رفعت شموط
📞 0795629606

✅ الفرع الثاني: أبو نصير – دوار البحرية - مجمع الفرّا التجاري
📞 0790368603`;window.open(`https://wa.me/962${C}?text=${encodeURIComponent(P)}`,"_blank")};return e.jsxs("div",{className:"space-y-6 animate-fade-in font-sans",children:[e.jsx(ms,{isOpen:S,onClose:()=>M(!1),groups:E,allStudents:s,onSend:D}),$&&e.jsx(hs,{student:$,onClose:()=>u(null),onSave:ce}),L&&e.jsx(bs,{student:L,onClose:()=>O(null),onSave:R}),I&&e.jsx(Pe,{onClose:()=>d(null),children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:e.jsx(ht,{size:32})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"تم تسجيل البطل بنجاح!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["الطالب: ",e.jsx("strong",{children:I.name})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border rounded-xl mb-6 dir-ltr text-left relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-2 bg-yellow-400 text-xs font-bold text-black rounded-bl-lg",children:"Credentials"}),e.jsxs("p",{className:"font-mono text-sm mb-1",children:["User: ",e.jsx("strong",{className:"text-lg text-blue-900 select-all",children:I.username})]}),e.jsxs("p",{className:"font-mono text-sm",children:["Pass: ",e.jsx("strong",{className:"text-lg text-red-600 select-all",children:I.password})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(F,{onClick:()=>T(I),className:"bg-[#25D366] hover:bg-[#20bd5a] text-white flex items-center justify-center gap-2",children:[e.jsx($e,{size:18})," إرسال واتساب"]}),e.jsx(F,{variant:"outline",onClick:()=>d(null),children:"إغلاق"})]})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-4 justify-between items-center sticky top-0 z-20",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(_e,{size:18,className:"text-gray-400"})}),e.jsx("input",{className:"w-full pl-4 pr-10 py-2.5 border-2 border-gray-100 rounded-xl focus:border-yellow-500 focus:ring-4 focus:ring-yellow-500/10 outline-none transition-all",placeholder:"ابحث عن اسم، هاتف، يوزر...",value:l,onChange:t=>b(t.target.value),list:"students-suggestions"}),e.jsx("datalist",{id:"students-suggestions",children:s.map(t=>e.jsx("option",{value:t.name},t.id))})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0 hide-scrollbar",children:[e.jsxs(F,{onClick:()=>M(!0),className:"bg-blue-50 text-blue-600 border border-blue-100 hover:bg-blue-100 whitespace-nowrap flex items-center gap-2",children:[e.jsx(ke,{size:18})," ",e.jsx("span",{className:"hidden sm:inline",children:"إعلان للكل"})]}),e.jsxs("div",{className:"relative min-w-[120px]",children:[e.jsxs("select",{className:"w-full appearance-none bg-gray-50 border border-gray-200 text-gray-700 py-2.5 pr-8 pl-8 rounded-xl focus:outline-none focus:border-yellow-500 cursor-pointer text-sm font-bold",value:v,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"all",children:"كل الحالات"}),e.jsx("option",{value:"active",children:"🟢 فعال"}),e.jsx("option",{value:"near_end",children:"🟡 قارب الانتهاء"}),e.jsx("option",{value:"expired",children:"🔴 منتهي"})]}),e.jsx(kt,{size:14,className:"absolute top-1/2 -translate-y-1/2 right-3 text-gray-500 pointer-events-none"})]}),e.jsxs("div",{className:"relative min-w-[140px]",children:[e.jsxs("select",{className:"w-full appearance-none bg-gray-50 border border-gray-200 text-gray-700 py-2.5 pr-8 pl-8 rounded-xl focus:outline-none focus:border-yellow-500 cursor-pointer text-sm font-bold",value:p,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"joinDateDesc",children:"📅 الأحدث"}),e.jsx("option",{value:"joinDateAsc",children:"📅 الأقدم"}),e.jsx("option",{value:"beltDesc",children:"🥋 أعلى حزام"}),e.jsx("option",{value:"balanceDesc",children:"💰 المديونية"})]}),p.includes("Desc")?e.jsx(Wt,{size:14,className:"absolute top-1/2 -translate-y-1/2 right-3 text-gray-500 pointer-events-none"}):e.jsx(Yt,{size:14,className:"absolute top-1/2 -translate-y-1/2 right-3 text-gray-500 pointer-events-none"})]}),e.jsxs(F,{onClick:()=>{m(null),f(!0)},className:"whitespace-nowrap flex items-center gap-2 shadow-lg shadow-yellow-500/20",children:[e.jsx(Bt,{size:18})," ",e.jsx("span",{className:"hidden sm:inline",children:"طالب جديد"}),e.jsx("span",{className:"inline sm:hidden",children:"جديد"})]})]})]}),e.jsx(J,{className:"hidden md:block overflow-hidden border-none shadow-md rounded-2xl p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-bold",children:"الطالب"}),e.jsx("th",{className:"p-4 font-bold",children:"الفترة"}),e.jsx("th",{className:"p-4 font-bold",children:"معلومات الاتصال"}),e.jsx("th",{className:"p-4 font-bold",children:"بيانات الدخول"}),e.jsx("th",{className:"p-4 font-bold",children:"الحزام"}),e.jsx("th",{className:"p-4 font-bold",children:"الحالة المالية"}),e.jsx("th",{className:"p-4 font-bold",children:"الاشتراك"}),e.jsx("th",{className:"p-4 font-bold",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:_.map(t=>{const C=pt(t.joinDate),P=t.internalNotes&&t.internalNotes.length>0||t.note&&t.note.trim()!=="",H=t.notes&&t.notes.length>0;return e.jsxs("tr",{className:"hover:bg-yellow-50/50 transition-colors group",children:[e.jsxs("td",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P&&e.jsx("button",{onClick:()=>u(t),className:"text-red-500 hover:scale-110 transition-transform",title:"يوجد ملاحظات خاصة!",children:e.jsx(bt,{size:20,fill:"currentColor",className:"text-red-100"})}),e.jsx("div",{className:"font-bold text-gray-800 text-base cursor-pointer hover:text-blue-600",onClick:()=>u(t),children:t.name}),C&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-red-100 text-red-600 text-[10px] font-bold border border-red-200 animate-pulse",children:"NEW"})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:De(t.joinDate)})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-bold border border-blue-100",children:t.group||"غير محدد"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("a",{href:`tel:${t.phone}`,className:"font-mono text-gray-600 hover:text-blue-600 font-bold flex items-center gap-1",title:"اتصال",children:[t.phone," ",e.jsx(Me,{size:12,className:"opacity-50"})]}),e.jsx("button",{onClick:()=>q(t.phone),className:"w-8 h-8 rounded-full bg-green-50 text-[#25D366] flex items-center justify-center hover:bg-[#25D366] hover:text-white transition-all shadow-sm",children:e.jsx(ue,{size:16})})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-gray-50 p-1.5 rounded-lg text-xs font-mono border border-gray-100",children:[e.jsxs("div",{className:"text-blue-900",children:["U: ",t.username]}),e.jsxs("div",{className:"text-red-600 font-bold",children:["P: ",t.password]})]}),e.jsx("button",{onClick:()=>T(t),className:"text-gray-400 hover:text-[#25D366] transition-colors",children:e.jsx($e,{size:16})})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 rounded-lg font-bold text-xs border border-gray-200",children:t.belt})}),e.jsx("td",{className:"p-4",children:t.balance>0?e.jsxs("span",{className:"text-red-600 font-bold bg-red-50 px-2 py-1 rounded text-xs",children:["عليه ",t.balance]}):e.jsx("span",{className:"text-green-600 font-bold text-xs",children:"مدفوع"})}),e.jsx("td",{className:"p-4",children:e.jsx(Le,{status:et(t.subEnd)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>O(t),className:"bg-green-100 text-green-700 p-2 rounded-lg hover:bg-green-600 hover:text-white transition",title:"تجديد الاشتراك",children:e.jsx(rt,{size:16})}),e.jsx("button",{onClick:()=>u(t),className:`p-2 rounded-lg transition ${H||P?"bg-yellow-100 text-yellow-700":"bg-gray-50 text-gray-400 hover:text-yellow-600"}`,title:"الملاحظات",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>ae(t),className:"bg-blue-50 text-blue-600 p-2 rounded-lg hover:bg-blue-600 hover:text-white transition",title:"ترفيع",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:()=>y(t),className:"bg-gray-100 text-gray-600 p-2 rounded-lg hover:bg-gray-600 hover:text-white transition",title:"تعديل",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>le(t),className:"bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-600 hover:text-white transition",title:"أرشفة",children:e.jsx(Te,{size:16})})]})})]},t.id)})})]})})}),e.jsxs("div",{className:"md:hidden grid grid-cols-1 gap-4",children:[_.map(t=>{const C=pt(t.joinDate),P=et(t.subEnd),H=t.internalNotes&&t.internalNotes.length>0||t.note&&t.note.trim()!=="";return e.jsxs("div",{className:`bg-white p-4 rounded-xl shadow-sm border ${H?"border-red-200 ring-1 ring-red-100":"border-gray-100"} flex flex-col gap-3 relative`,children:[H&&e.jsx("div",{className:"absolute top-4 left-14 animate-pulse",children:e.jsx(bt,{size:20,className:"text-red-500 fill-red-100"})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:t.name}),C&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-600 px-2 rounded-full animate-pulse",children:"NEW"})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["منذ: ",De(t.joinDate)]}),e.jsx("span",{className:"text-[10px] bg-blue-50 text-blue-700 px-1.5 py-0.5 rounded font-bold mt-1 inline-block",children:t.group||"غير محدد"})]}),e.jsx(Le,{status:P})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-gray-50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-gray-500 text-xs block",children:"الحزام"}),e.jsx("span",{className:"font-bold text-gray-800",children:t.belt})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t.balance>0?"bg-red-50 text-red-700":"bg-green-50 text-green-700"}`,children:[e.jsx("span",{className:"text-xs block opacity-70",children:"الرصيد"}),e.jsx("span",{className:"font-bold",children:t.balance>0?`عليه ${t.balance}`:"مدفوع"})]})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded-lg border border-gray-100 border-dashed",children:[e.jsxs("div",{className:"text-xs font-mono text-gray-600",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-bold text-blue-800",children:"U:"})," ",t.username]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-red-600",children:"P:"})," ",t.password]})]}),e.jsx("button",{onClick:()=>T(t),className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200",children:e.jsx($e,{size:16})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100 mt-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:`tel:${t.phone}`,className:"p-2 bg-gray-100 rounded-full text-gray-600",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:()=>q(t.phone),className:"p-2 bg-green-100 rounded-full text-[#25D366]",children:e.jsx(ue,{size:16})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>O(t),className:"p-2 bg-green-100 text-green-700 rounded-lg",children:e.jsx(rt,{size:16})}),e.jsx("button",{onClick:()=>u(t),className:`p-2 rounded-lg ${H?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>ae(t),className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:()=>y(t),className:"p-2 bg-yellow-50 text-yellow-600 rounded-lg",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>le(t),className:"p-2 bg-red-50 text-red-600 rounded-lg",children:e.jsx(Te,{size:16})})]})]})]},t.id)}),_.length===0&&e.jsx("div",{className:"text-center p-8 text-gray-400",children:"لا يوجد نتائج"})]}),N&&e.jsx(Pe,{onClose:G,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:g?"تعديل بيانات الطالب":"إضافة 'طالب' جديد"}),e.jsx("button",{onClick:G,className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(xe,{size:24})})]}),e.jsxs("form",{onSubmit:g?X:W,className:"space-y-4 text-right",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 bg-gradient-to-r from-yellow-50 to-white p-4 rounded-xl border border-yellow-200 mb-2",children:[e.jsxs("p",{className:"text-xs font-bold text-yellow-700 mb-3 flex items-center gap-1",children:[e.jsx(ht,{size:12})," بيانات تسجيل الدخول (اتركها فارغة للتوليد التلقائي)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-gray-500 mb-1 uppercase tracking-wider",children:"Username"}),e.jsx("input",{className:"w-full border border-gray-200 p-2 rounded-lg bg-white font-mono text-left dir-ltr focus:border-yellow-500 outline-none",value:k.username,onChange:t=>U({...k,username:t.target.value}),placeholder:"Auto-generated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-gray-500 mb-1 uppercase tracking-wider",children:"Password"}),e.jsx("input",{className:"w-full border border-gray-200 p-2 rounded-lg bg-white font-mono text-left dir-ltr focus:border-yellow-500 outline-none",value:k.password,onChange:t=>U({...k,password:t.target.value}),placeholder:"Auto-generated"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"الاسم الرباعي"}),e.jsx("input",{required:!0,className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl outline-none transition-all",value:k.name,onChange:t=>U({...k,name:t.target.value}),placeholder:"مثال: أحمد محمد علي"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-blue-800 mb-1",children:"الفترة / المجموعة"}),e.jsxs("select",{className:"w-full border-2 border-blue-100 focus:border-blue-500 p-2.5 rounded-xl bg-blue-50/50 outline-none",value:k.group,onChange:t=>U({...k,group:t.target.value}),children:[e.jsx("option",{value:"",children:"بدون تحديد"}),E.map((t,C)=>e.jsx("option",{value:t,children:t},C))]})]}),!g&&e.jsxs("div",{className:"md:col-span-2 bg-blue-50 p-3 rounded-xl border border-blue-100",children:[e.jsx("label",{className:"block text-xs font-bold text-blue-800 mb-1",children:"العائلة (للخصومات)"}),e.jsxs("select",{className:"w-full border border-blue-200 p-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-200 outline-none",value:h,onChange:t=>A(t.target.value),children:[e.jsx("option",{value:"new",children:"تسجيل كعائلة جديدة"}),K.map(t=>e.jsxs("option",{value:t.id,children:["انضمام لـ ",t.displayName]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"رقم الهاتف"}),e.jsx("input",{required:!0,className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl outline-none",value:k.phone,onChange:t=>U({...k,phone:t.target.value}),placeholder:"079xxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"الحزام الحالي"}),e.jsx("select",{className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl bg-white outline-none",value:k.belt,onChange:t=>U({...k,belt:t.target.value}),children:V.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-red-600 mb-1",children:"الرصيد الافتتاحي (دينار)"}),e.jsx("input",{type:"number",className:"w-full border-2 border-red-50 focus:border-red-500 p-2.5 rounded-xl outline-none bg-red-50/30",value:k.balance,onChange:t=>U({...k,balance:t.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"تاريخ الميلاد"}),e.jsx("input",{type:"date",className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl outline-none",value:k.dob,onChange:t=>U({...k,dob:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"تاريخ الالتحاق"}),e.jsx("input",{type:"date",className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl outline-none",value:k.joinDate,onChange:t=>U({...k,joinDate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-600 mb-1",children:"نهاية الاشتراك"}),e.jsx("input",{type:"date",className:"w-full border-2 border-green-50 focus:border-green-500 p-2.5 rounded-xl outline-none bg-green-50/30",value:k.subEnd,onChange:t=>U({...k,subEnd:t.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"العنوان"}),e.jsx("input",{className:"w-full border-2 border-gray-100 focus:border-yellow-500 p-2.5 rounded-xl outline-none",value:k.address,onChange:t=>U({...k,address:t.target.value}),placeholder:"المدينة - المنطقة - الشارع"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-8 pt-4 border-t border-gray-100",children:[e.jsx(F,{type:"button",variant:"ghost",onClick:G,className:"text-gray-500 hover:bg-gray-100",children:"إلغاء"}),e.jsx(F,{type:"submit",className:"bg-yellow-500 text-black font-bold hover:bg-yellow-400 shadow-lg shadow-yellow-500/20 px-8",children:g?"حفظ التعديلات":"إضافة الطالب"})]})]})]})})]})},us=({archiveCollection:s,studentsCollection:a,payments:o,logActivity:x})=>{const[r,c]=j.useState(null),[l,b]=j.useState(null),[v,w]=j.useState(""),p=s.data.filter(m=>m.name.includes(v)),i=async m=>{if(!window.confirm(`هل تريد إعادة تفعيل اشتراك الطالب ${m.name}؟

(سيتم الحفاظ على تاريخ الالتحاق الأصلي)`))return;const{archivedAt:I,originalId:d,id:$,...u}=m;await a.add({...u,status:"active",joinDate:u.joinDate||new Date().toISOString().split("T")[0]}),await s.remove(m.id),x("استعادة",`تمت استعادة الطالب ${m.name} من الأرشيف`)},N=(m,I)=>{alert("Print functionality for: "+m.id)},f=m=>{if(!m)return;let I=m.replace(/\D/g,"");I.startsWith("0")&&(I=I.substring(1)),window.open(`https://wa.me/962${I}`,"_blank")},g=m=>{const I=m.originalId||m.id;return o.filter(d=>d.studentId===I||d.studentIds&&d.studentIds.includes(I))};return e.jsxs("div",{className:"space-y-6",children:[l&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4 backdrop-blur-sm",children:e.jsxs(J,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",title:`بطاقة الطالب المؤرشف: ${l.name}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsxs("h4",{className:"font-bold text-gray-800 border-b pb-2 mb-3 flex items-center gap-2",children:[e.jsx(Ve,{size:16,className:"text-blue-600"})," البيانات الشخصية"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"الاسم:"})," ",l.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"الهاتف:"})," ",l.phone]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"الحزام:"})," ",l.belt]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"المجموعة:"})," ",l.group||"غير محدد"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"تاريخ الميلاد:"})," ",l.dob||"غير مدخل"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsxs("h4",{className:"font-bold text-gray-800 border-b pb-2 mb-3 flex items-center gap-2",children:[e.jsx(je,{size:16,className:"text-green-600"})," التواريخ والعنوان"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"تاريخ الالتحاق الأصلي:"})," ",l.joinDate]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"تاريخ الأرشفة:"})," ",l.archivedAt]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-bold",children:"تاريخ انتهاء الاشتراك (عند الأرشفة):"})," ",l.subEnd]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(Ae,{size:14,className:"text-gray-400 mt-1"}),e.jsx("span",{className:"text-gray-800",children:l.address||"لا يوجد عنوان مسجل"})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-200",children:[e.jsxs("h4",{className:"font-bold text-gray-800 border-b border-yellow-200 pb-2 mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-yellow-600"})," بيانات الدخول"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono dir-ltr text-right",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-sans font-bold float-right ml-2",children:":Username"})," ",l.username]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-sans font-bold float-right ml-2",children:":Password"})," ",l.password]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-200",children:[e.jsxs("h4",{className:"font-bold text-gray-800 border-b border-red-200 pb-2 mb-3 flex items-center gap-2",children:[e.jsx(Je,{size:16,className:"text-red-600"})," ملاحظات إدارية"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto custom-scrollbar text-sm",children:l.internalNotes&&l.internalNotes.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.internalNotes.map((m,I)=>e.jsxs("li",{className:"text-gray-700",children:[m.text," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",m.date,")"]})]},I))}):e.jsx("p",{className:"text-gray-400 italic",children:"لا يوجد ملاحظات"})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(F,{onClick:()=>b(null),children:"إغلاق"}),e.jsxs(F,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{i(l),b(null)},children:[e.jsx(gt,{size:16,className:"ml-2"})," استعادة الطالب"]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4 backdrop-blur-sm",children:e.jsxs(J,{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto",title:`الملف المالي: ${r.name}`,children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:`p-4 rounded-xl border-2 text-center ${r.balance>0?"bg-red-50 border-red-500":"bg-green-50 border-green-500"}`,children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"الرصيد المتبقي (ذمم)"}),e.jsxs("p",{className:`text-2xl font-bold ${r.balance>0?"text-red-600":"text-green-600"}`,children:[r.balance," JOD"]})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-gray-50 text-center",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"تاريخ الأرشفة"}),e.jsx("p",{className:"text-xl font-bold",children:r.archivedAt||"غير مسجل"})]})]}),e.jsxs("h4",{className:"font-bold border-b pb-2 mb-4 text-gray-800 flex items-center gap-2",children:[e.jsx(We,{size:18,className:"text-green-600"})," سجل الدفعات والوصلات السابقة"]}),g(r).length>0?e.jsx("div",{className:"space-y-3",children:g(r).map(m=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-lg border hover:shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:m.reason}),e.jsxs("p",{className:"text-xs text-gray-500",children:[m.date," - ",m.branch]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-bold text-green-600",children:[m.amount," JOD"]}),e.jsx("button",{onClick:()=>N(m,m.branch),className:"text-gray-400 hover:text-black",title:"طباعة نسخة",children:e.jsx(be,{size:16})})]})]},m.id))}):e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded border-2 border-dashed",children:e.jsx("p",{className:"text-gray-400",children:"لا يوجد سجلات مالية مؤرشفة لهذا الطالب"})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(F,{onClick:()=>c(null),children:"إغلاق الملف"})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Te,{className:"text-red-500"})," أرشيف الطلاب"]}),e.jsx("div",{className:"w-64",children:e.jsx("input",{className:"w-full border p-2 rounded shadow-sm",placeholder:"بحث في الأرشيف...",value:v,onChange:m=>w(m.target.value)})})]}),e.jsx(J,{noPadding:!0,children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{size:48,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"الأرشيف فارغ حالياً"})]}):e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"اسم الطالب"}),e.jsx("th",{className:"p-4",children:"الهاتف"}),e.jsx("th",{className:"p-4",children:"تاريخ الأرشفة"}),e.jsx("th",{className:"p-4",children:"الذمم المالية"}),e.jsx("th",{className:"p-4",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y",children:p.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsxs("td",{className:"p-4 font-bold text-gray-800",children:[m.name," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:m.belt})]}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`tel:${m.phone}`,className:"hover:text-blue-600",children:m.phone}),e.jsx("button",{onClick:()=>f(m.phone),className:"text-green-500 hover:bg-green-100 p-1 rounded-full",children:e.jsx(ue,{size:16})})]})}),e.jsx("td",{className:"p-4 text-gray-600",children:m.archivedAt}),e.jsx("td",{className:"p-4",children:Number(m.balance)>0?e.jsxs("span",{className:"bg-red-100 text-red-700 px-3 py-1 rounded-full font-bold text-xs",children:["عليه ",m.balance," JOD"]}):e.jsxs("span",{className:"bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-xs flex items-center gap-1 w-fit",children:[e.jsx(ve,{size:12})," مدفوع"]})}),e.jsxs("td",{className:"p-4 flex gap-2",children:[e.jsx("button",{onClick:()=>b(m),className:"bg-gray-50 text-gray-600 p-2 rounded hover:bg-gray-200 border border-gray-200",title:"عرض كافة المعلومات",children:e.jsx(Kt,{size:16})}),e.jsxs(F,{variant:"outline",className:"py-1 px-3 text-xs border-gray-300 hover:bg-gray-100 text-gray-700",onClick:()=>c(m),children:[e.jsx(we,{size:14,className:"ml-1"})," الملف المالي"]}),e.jsx("button",{onClick:()=>i(m),className:"bg-blue-50 text-blue-600 p-2 rounded hover:bg-blue-100 border border-blue-200",title:"إعادة تفعيل الطالب (استرجاع)",children:e.jsx(gt,{size:16})}),e.jsx("button",{onClick:async()=>{window.confirm("حذف نهائي من السجلات؟ لا يمكن التراجع!")&&await s.remove(m.id)},className:"bg-red-50 text-red-600 p-2 rounded hover:bg-red-100 border border-red-200",title:"حذف نهائي",children:e.jsx(ne,{size:16})})]})]},m.id))})]})})]})},ps=({isOpen:s,onClose:a,reasons:o,onAdd:x,onDelete:r})=>{const[c,l]=j.useState("");return s?Be.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ge,{size:20,className:"text-gray-600"})," إدارة بنود الدفع"]}),e.jsx("button",{onClick:a,children:e.jsx(xe,{size:20,className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{className:"flex-1 border-2 border-gray-200 rounded-xl px-4 py-2 focus:border-green-500 outline-none",placeholder:"اسم البند الجديد...",value:c,onChange:b=>l(b.target.value)}),e.jsx("button",{onClick:()=>{c&&(x(c),l(""))},className:"bg-green-600 text-white p-3 rounded-xl hover:bg-green-700",children:e.jsx(dt,{size:20})})]}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 custom-scrollbar",children:[o.map((b,v)=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"font-bold text-gray-700",children:b.title}),e.jsx("button",{onClick:()=>r(b),className:"text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors",children:e.jsx(ne,{size:18})})]},v)),o.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"لا يوجد بنود مضافة"})]})]})]}),document.body):null},fs=({isOpen:s,onClose:a,onGenerate:o})=>{const[x,r]=j.useState(new Date().toISOString().split("T")[0]),[c,l]=j.useState(new Date().toISOString().split("T")[0]);return s?Be.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2 text-blue-800",children:[e.jsx(St,{size:24})," التقرير المالي المفصل"]}),e.jsx("button",{onClick:a,children:e.jsx(xe,{size:20,className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"من تاريخ"}),e.jsx("input",{type:"date",value:x,onChange:b=>r(b.target.value),className:"w-full border-2 border-gray-200 p-3 rounded-xl outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"إلى تاريخ"}),e.jsx("input",{type:"date",value:c,onChange:b=>l(b.target.value),className:"w-full border-2 border-gray-200 p-3 rounded-xl outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(F,{onClick:()=>o(x,c),className:"w-full bg-blue-600 text-white hover:bg-blue-700 py-3 shadow-lg shadow-blue-600/20",children:[e.jsx(be,{size:18,className:"ml-2"})," استخراج وطباعة التقرير"]})})]})]})]}),document.body):null};function js({students:s,payments:a,expenses:o,paymentsCollection:x,expensesCollection:r,selectedBranch:c,logActivity:l,financeReasons:b=[],financeReasonsCollection:v}){const[w,p]=j.useState("income"),[i,N]=j.useState({sid:"",amount:"",reason:"",customReason:"",details:"",method:"cash",extraName:""}),[f,g]=j.useState({title:"",amount:"",date:new Date().toISOString().split("T")[0]}),[m,I]=j.useState(null),[d,$]=j.useState(!1),[u,S]=j.useState(!1),M=a.filter(y=>y.branch===c),L=o.filter(y=>y.branch===c),O=(m?M.filter(y=>y.studentId===m):M).sort((y,G)=>new Date(G.createdAt||G.date)-new Date(y.createdAt||y.date)),E=[...L].sort((y,G)=>new Date(G.date)-new Date(y.date)),n=async y=>{if(b.some(G=>G.title===y))return alert("هذا البند موجود مسبقاً");await v.add({title:y,branch:c,createdAt:new Date().toISOString()})},k=async y=>{confirm(`حذف البند "${y.title}"؟`)&&await v.remove(y.id)},U=async y=>{if(y.preventDefault(),!i.studentObjId)return alert("اختر طالباً");const G=s.find(ce=>ce.id===i.studentObjId);if(!G)return alert("طالب غير موجود");if(!i.reason&&b.length>0)return alert("الرجاء اختيار سبب الدفع");const X=i.reason==="أخرى"?i.customReason:i.reason,ae=i.extraName?`${G.name} و ${i.extraName}`:G.name,le={id:Date.now().toString(),studentId:G.id,name:ae,amount:Number(i.amount),reason:X,details:i.details,method:i.method||"cash",date:new Date().toISOString().split("T")[0],branch:c};await x.add(le),l("قبض مالي",`استلام ${i.amount} من ${ae}`),N({sid:"",amount:"",reason:"",customReason:"",details:"",method:"cash",extraName:""})},h=async y=>{y.preventDefault(),await r.add({id:Date.now().toString(),title:f.title,amount:Number(f.amount),date:f.date,branch:c}),l("مصروف",`صرف ${f.amount} لـ ${f.title}`),g({title:"",amount:"",date:new Date().toISOString().split("T")[0]})},A=async y=>{confirm("حذف السند؟")&&await x.remove(y)},K=async y=>{confirm("حذف المصروف؟")&&await r.remove(y)},_=(y,G)=>{const X=M.filter(T=>{const t=new Date(T.date),C=new Date(y),P=new Date(G);return t>=C&&t<=P}).sort((T,t)=>new Date(T.date)-new Date(t.date)),ae=X.filter(T=>!T.method||T.method==="cash").reduce((T,t)=>T+t.amount,0),le=X.filter(T=>T.method==="cliq").reduce((T,t)=>T+t.amount,0),ce=ae+le,D=window.open("","REPORT","height=800,width=1000"),R=window.location.origin+de.LOGO,q=`
      <!DOCTYPE html>
      <html lang="ar" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>تقرير مالي - ${c}</title>
          <style>
             @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
             body { font-family: 'Cairo', sans-serif; padding: 20px; }
             .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
             .logo { height: 80px; margin-bottom: 10px; }
             .stats-box { display: flex; gap: 20px; margin-bottom: 30px; justify-content: center; }
             .stat { border: 1px solid #ddd; padding: 15px; border-radius: 10px; width: 200px; text-align: center; }
             .stat-title { font-size: 14px; color: #666; font-weight: bold; }
             .stat-value { font-size: 24px; font-weight: bold; margin-top: 5px; }
             .cash { border-color: #16a34a; background: #f0fdf4; color: #16a34a; }
             .cliq { border-color: #2563eb; background: #eff6ff; color: #2563eb; }
             .total { border-color: #000; background: #fafafa; color: #000; }
             
             table { width: 100%; border-collapse: collapse; font-size: 14px; }
             th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
             th { background-color: #f3f4f6; }
             tr:nth-child(even) { background-color: #f9fafb; }
             
             @media print {
                button { display: none; }
                body { padding: 0; }
             }
          </style>
        </head>
        <body>
            <div class="header">
                <img src="${R}" class="logo" onerror="this.style.display='none'"/>
                <h2>تقرير المقبوضات المالي</h2>
                <p>الفرع: ${c}</p>
                <p>الفترة: من <strong>${y}</strong> إلى <strong>${G}</strong></p>
            </div>

            <div class="stats-box">
                <div class="stat cash">
                    <div class="stat-title">مجموع الكاش</div>
                    <div class="stat-value">${ae} JD</div>
                </div>
                <div class="stat cliq">
                    <div class="stat-title">مجموع كليك (CliQ)</div>
                    <div class="stat-value">${le} JD</div>
                </div>
                <div class="stat total">
                    <div class="stat-title">الإجمالي الكلي</div>
                    <div class="stat-value">${ce} JD</div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>التاريخ</th>
                        <th>الطالب</th>
                        <th>المبلغ</th>
                        <th>طريقة الدفع</th>
                        <th>البيان</th>
                    </tr>
                </thead>
                <tbody>
                    ${X.map((T,t)=>`
                        <tr>
                            <td>${t+1}</td>
                            <td>${T.date}</td>
                            <td>${T.name}</td>
                            <td style="font-weight:bold">${T.amount}</td>
                            <td>${T.method==="cliq"?"كليك (CliQ)":"كاش"}</td>
                            <td>${T.reason} ${T.details?`(${T.details})`:""}</td>
                        </tr>
                    `).join("")}
                    ${X.length===0?'<tr><td colspan="6" style="text-align:center">لا يوجد بيانات في هذه الفترة</td></tr>':""}
                </tbody>
            </table>

            <div style="margin-top: 40px; display: flex; justify-content: space-between; padding: 0 50px;">
                <div> </div>
                <div>توقيع الإدارة</div>
            </div>
            
            <script>
               window.onload = function() { window.print(); }
            <\/script>
        </body>
      </html>
    `;D.document.write(q),D.document.close(),S(!1)},W=y=>{const G=window.open("","PRINT","height=800,width=1000"),X=window.location.origin+de.LOGO,ae=y.method==="cliq"?"كليك (CliQ)":"نقدًا (Cash)",le=`
      <!DOCTYPE html>
      <html lang="ar" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>سند قبض - ${y.name}</title>
          <style>
            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
            @page { size: A5 landscape; margin: 0; }
            body { font-family: 'Cairo', sans-serif; margin: 0; padding: 10mm; background-color: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; height: 100vh; box-sizing: border-box; }
            .receipt-border { border: 3px double #444; height: 96%; position: relative; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; }
            .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-25deg); width: 50%; opacity: 0.08; z-index: 0; pointer-events: none; filter: grayscale(100%); }
            .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #b45309; padding-bottom: 10px; margin-bottom: 15px; position: relative; z-index: 2; }
            .company-info h1 { margin: 0; font-size: 22px; color: #b45309; font-weight: 900; }
            .company-info p { margin: 2px 0; font-size: 12px; font-weight: bold; color: #555; }
            .logo img { height: 70px; object-fit: contain; }
            .meta-info { text-align: left; font-size: 12px; border-right: 2px solid #eee; padding-right: 10px; }
            .meta-info div { margin-bottom: 3px; }
            .content { position: relative; z-index: 2; flex-grow: 1; }
            .title { text-align: center; font-size: 24px; font-weight: 900; margin: 10px 0 20px; text-decoration: underline; text-decoration-color: #b45309; text-underline-offset: 5px; }
            .row { display: flex; align-items: baseline; margin-bottom: 12px; font-size: 16px; }
            .label { font-weight: bold; width: 110px; color: #333; }
            .value { flex: 1; border-bottom: 1px dotted #888; font-weight: 700; padding: 0 5px; }
            .amount-container { position: absolute; left: 20px; top: 40px; border: 2px solid #333; padding: 5px 15px; border-radius: 8px; background: #f9f9f9; transform: rotate(-5deg); box-shadow: 2px 2px 0 #ccc; }
            .amount-number { font-size: 20px; font-weight: 900; direction: ltr; }
            .footer { margin-top: 20px; position: relative; z-index: 2; }
            .signatures { display: flex; justify-content: space-between; padding: 0 40px; margin-bottom: 15px; }
            .sign-box { text-align: center; width: 150px; }
            .sign-line { border-top: 1px solid #333; margin-bottom: 5px; }
            .sign-title { font-size: 12px; font-weight: bold; color: #555; }
            .branches-box { border-top: 2px solid #b45309; padding-top: 8px; font-size: 10px; display: flex; justify-content: space-between; background: #fff; }
            .branch { display: flex; flex-direction: column; width: 48%; }
            .branch span { display: block; margin-bottom: 2px; }
            .phone { direction: ltr; text-align: right; font-weight: bold; }
          </style>
        </head>
        <body>
          <div class="receipt-border">
            <img src="${X}" class="watermark" onerror="this.style.display='none'"/>
            <div class="header">
              <div class="company-info">
                <h1>أكاديمية الشجاع للتايكواندو</h1>
                <p>فرع: ${c}</p>
              </div>
              <div class="logo">
                <img src="${X}" onerror="this.style.display='none'"/>
              </div>
              <div class="meta-info">
                <div>رقم السند: <strong>${y.id.slice(-6)}</strong></div>
                <div>التاريخ: <strong>${y.date}</strong></div>
              </div>
            </div>
            <div class="content">
              <div class="title">سند قبض</div>
              <div class="amount-container">
                <div class="amount-number">${y.amount} JD</div>
              </div>
              <div class="row">
                <span class="label">استلمنا من:</span>
                <span class="value">${y.name}</span>
              </div>
              <div class="row">
                <span class="label">مبلغ وقدره:</span>
                <span class="value">${y.amount} دينار أردني</span>
              </div>
              <div class="row">
                <span class="label">طريقة الدفع:</span>
                <span class="value">${ae}</span>
              </div>
              <div class="row">
                <span class="label">وذلك عن:</span>
                <span class="value">${y.reason} ${y.details?`(${y.details})`:""}</span>
              </div>
            </div>
            <div class="footer">
              <div class="signatures">
                <div class="sign-box">
                  <div class="sign-line"></div>
                  <div class="sign-title">توقيع الادارة</div>
                </div>
                <div class="sign-box">
                  <div class="sign-line"></div>
                  <div class="sign-title">توقيع المستلم</div>
                </div>
              </div>
              <div class="branches-box">
                <div class="branch">
                  <span style="font-weight:bold; color:#b45309">الفرع الأول: شفابدران</span>
                  <span>شارع رفعت شموط</span>
                  <span class="phone">079 5629 606</span>
                </div>
                <div class="branch">
                  <span style="font-weight:bold; color:#b45309">الفرع الثاني: أبو نصير</span>
                  <span>دوار البحرية - مجمع الفرّا</span>
                  <span class="phone">079 0368 603</span>
                </div>
              </div>
            </div>
          </div>
        </body>
      </html>
    `;G.document.write(le),G.document.close(),G.onload=()=>{G.focus(),setTimeout(()=>{G.print(),G.close()},500)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-20 md:pb-0",children:[e.jsx(ps,{isOpen:d,onClose:()=>$(!1),reasons:b,onAdd:n,onDelete:k}),e.jsx(fs,{isOpen:u,onClose:()=>S(!1),onGenerate:_}),e.jsxs("div",{className:"flex gap-4 mb-6 bg-gray-100 p-1 rounded-2xl",children:[e.jsx("button",{onClick:()=>p("income"),className:`flex-1 py-3 rounded-xl font-bold transition-all shadow-sm ${w==="income"?"bg-green-600 text-white shadow-green-200":"bg-white text-gray-500 hover:bg-gray-50"}`,children:"الإيرادات (القبض)"}),e.jsx("button",{onClick:()=>p("expense"),className:`flex-1 py-3 rounded-xl font-bold transition-all shadow-sm ${w==="expense"?"bg-red-600 text-white shadow-red-200":"bg-white text-gray-500 hover:bg-gray-50"}`,children:"المصاريف"})]}),w==="income"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(F,{onClick:()=>S(!0),className:"bg-blue-600 text-white hover:bg-blue-700 shadow-blue-500/20 shadow-lg flex items-center gap-2",children:[e.jsx(St,{size:18})," التقارير المالية"]})}),e.jsx(J,{title:"سند قبض جديد",className:"border-green-100 shadow-green-50",children:e.jsxs("form",{onSubmit:U,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"relative col-span-1 md:col-span-1",children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"اسم الطالب"}),e.jsx(Ye,{students:s,onSelect:y=>N({...i,sid:y.name,studentObjId:y.id}),placeholder:"ابحث..."})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"اسم الاخ (اختياري)"}),e.jsx("input",{className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-green-500 outline-none placeholder-gray-300 text-xs h-[45px]",value:i.extraName,onChange:y=>N({...i,extraName:y.target.value}),placeholder:"اكتب الاسم الثاني هنا"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"المبلغ"}),e.jsx("input",{type:"number",className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-green-500 outline-none",value:i.amount,onChange:y=>N({...i,amount:y.target.value}),required:!0,placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"طريقة الدفع"}),e.jsxs("select",{className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-green-500 outline-none bg-white h-[45px]",value:i.method,onChange:y=>N({...i,method:y.target.value}),children:[e.jsx("option",{value:"cash",children:"كاش (Cash)"}),e.jsx("option",{value:"cliq",children:"كليك (CliQ)"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"text-xs block mb-1 font-bold text-gray-700 flex justify-between",children:["السبب",e.jsxs("button",{type:"button",onClick:()=>$(!0),className:"text-green-600 hover:text-green-800 text-[10px] flex items-center gap-1 bg-green-50 px-2 py-0.5 rounded cursor-pointer",children:[e.jsx(Ge,{size:10})," تعديل القائمة"]})]}),e.jsxs("select",{className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-green-500 outline-none bg-white cursor-pointer h-[45px]",value:i.reason,onChange:y=>N({...i,reason:y.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:"اختر السبب..."}),b.map((y,G)=>e.jsx("option",{value:y.title,children:y.title},G)),e.jsx("option",{value:"أخرى",children:"أخرى (كتابة يدوية)"})]})]}),i.reason==="أخرى"&&e.jsxs("div",{className:"col-span-1 md:col-span-4",children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"وضح السبب"}),e.jsx("input",{className:"w-full border-2 border-gray-100 p-2 rounded-xl outline-none",value:i.customReason,onChange:y=>N({...i,customReason:y.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-1 md:col-span-4",children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"تفاصيل إضافية (اختياري)"}),e.jsx("input",{className:"w-full border-2 border-gray-100 p-2 rounded-xl outline-none",value:i.details,onChange:y=>N({...i,details:y.target.value}),placeholder:"مثال: عن شهر 12 + 1"})]}),e.jsx("div",{className:"col-span-1 md:col-span-4 mt-2",children:e.jsx(F,{type:"submit",className:"w-full bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/20 py-3",children:"حفظ وقبض"})})]})}),e.jsx("div",{className:"flex items-center gap-2 mb-2 w-full md:w-64",children:e.jsx(Ye,{students:s,onSelect:y=>I(y.id),onClear:()=>I(null),placeholder:"فلترة حسب الطالب...",showAllOption:!0})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(J,{children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 rounded-r-lg",children:"#"}),e.jsx("th",{className:"p-3",children:"الطالب"}),e.jsx("th",{className:"p-3",children:"البيان"}),e.jsx("th",{className:"p-3",children:"طريقة الدفع"}),e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"المبلغ"}),e.jsx("th",{className:"p-3",children:"طباعة"}),e.jsx("th",{className:"p-3 rounded-l-lg",children:"حذف"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[O.map(y=>e.jsxs("tr",{className:"hover:bg-green-50 transition-colors",children:[e.jsx("td",{className:"p-3 text-gray-400 font-mono text-xs",children:y.id.slice(-6)}),e.jsx("td",{className:"p-3 font-bold text-gray-800",children:y.name}),e.jsxs("td",{className:"p-3 text-gray-600",children:[e.jsx("span",{className:"block font-bold text-xs",children:y.reason}),e.jsx("span",{className:"text-[10px] text-gray-400",children:y.details})]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded-full ${y.method==="cliq"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:y.method==="cliq"?"كليك":"كاش"})}),e.jsx("td",{className:"p-3 text-xs text-gray-500",children:y.date}),e.jsxs("td",{className:"p-3 font-bold text-green-600",children:["+",y.amount]}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>W(y),className:"p-2 bg-gray-100 rounded-lg hover:bg-gray-200 text-gray-600",children:e.jsx(be,{size:16})})}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>A(y.id),className:"p-2 bg-red-50 rounded-lg hover:bg-red-100 text-red-500",children:e.jsx(ne,{size:16})})})]},y.id)),O.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-gray-400",children:"لا يوجد سندات"})})]})]})})}),e.jsxs("div",{className:"md:hidden grid gap-4",children:[O.map(y=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3 relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${y.method==="cliq"?"bg-blue-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start pl-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ve,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"font-bold text-gray-800",children:y.name})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx(je,{size:12})," ",y.date]})]}),e.jsxs("div",{className:"text-green-600 font-bold text-lg bg-green-50 px-2 py-1 rounded-lg",children:["+",y.amount]})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded-lg text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"font-bold text-xs text-gray-700",children:y.reason})]}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded ${y.method==="cliq"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:y.method==="cliq"?"كليك":"كاش"})]}),e.jsx("span",{className:"text-[10px] pr-6 block",children:y.details})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-1 border-t pt-3 border-gray-100",children:[e.jsxs("button",{onClick:()=>W(y),className:"flex items-center gap-1 text-xs bg-blue-50 text-blue-600 px-3 py-2 rounded-lg font-bold",children:[e.jsx(be,{size:14})," طباعة"]}),e.jsxs("button",{onClick:()=>A(y.id),className:"flex items-center gap-1 text-xs bg-red-50 text-red-600 px-3 py-2 rounded-lg font-bold",children:[e.jsx(ne,{size:14})," حذف"]})]})]},y.id)),O.length===0&&e.jsx("div",{className:"text-center p-8 text-gray-400 bg-gray-50 rounded-xl border border-dashed",children:"لا يوجد سندات"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"تسجيل مصروف",className:"border-red-100 shadow-red-50",children:e.jsxs("form",{onSubmit:h,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"البند (سبب الصرف)"}),e.jsx("input",{className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-red-500 outline-none",value:f.title,onChange:y=>g({...f,title:y.target.value}),required:!0,placeholder:"مثال: فاتورة كهرباء"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1 font-bold text-gray-700",children:"المبلغ"}),e.jsx("input",{type:"number",className:"w-full border-2 border-gray-100 p-2 rounded-xl focus:border-red-500 outline-none",value:f.amount,onChange:y=>g({...f,amount:y.target.value}),required:!0,placeholder:"0.00"})]}),e.jsx("div",{children:e.jsx(F,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/20 py-2.5",children:"حفظ"})})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(J,{children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 rounded-r-lg",children:"البند"}),e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"المبلغ"}),e.jsx("th",{className:"p-3 rounded-l-lg",children:"حذف"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:E.map(y=>e.jsxs("tr",{className:"hover:bg-red-50 transition-colors",children:[e.jsx("td",{className:"p-3 font-bold text-gray-700",children:y.title}),e.jsx("td",{className:"p-3 text-gray-500 text-xs",children:y.date}),e.jsxs("td",{className:"p-3 text-red-600 font-bold",children:["-",y.amount]}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>K(y.id),className:"text-red-500 p-2 bg-red-50 rounded-lg hover:bg-red-100",children:e.jsx(ne,{size:16})})})]},y.id))})]})})}),e.jsxs("div",{className:"md:hidden grid gap-4",children:[E.map(y=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-red-500"}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-gray-800",children:y.title}),e.jsx("span",{className:"text-xs text-gray-400 block mt-1",children:y.date})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("span",{className:"font-bold text-red-600 text-lg",children:["-",y.amount]}),e.jsx("button",{onClick:()=>K(y.id),className:"text-red-400 hover:text-red-600 bg-red-50 p-1.5 rounded-lg",children:e.jsx(ne,{size:16})})]})]},y.id)),E.length===0&&e.jsx("div",{className:"text-center p-8 text-gray-400 bg-gray-50 rounded-xl border border-dashed",children:"لا يوجد مصاريف"})]})]})]})}const ys=({isOpen:s,onClose:a,groups:o,onAdd:x,onDelete:r})=>{const[c,l]=j.useState("");return s?Be.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ge,{size:20,className:"text-gray-600"})," إدارة الفترات والمجموعات"]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{className:"flex-1 border-2 border-gray-200 rounded-xl px-4 py-2 focus:border-blue-500 outline-none",placeholder:"اسم الفترة الجديدة...",value:c,onChange:b=>l(b.target.value)}),e.jsx("button",{onClick:()=>{c&&(x(c),l(""))},className:"bg-blue-600 text-white p-3 rounded-xl hover:bg-blue-700",children:e.jsx(dt,{size:20})})]}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-4",children:[o.map((b,v)=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"font-bold text-gray-700",children:b.name}),e.jsx("button",{onClick:()=>r(b),className:"text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors",children:e.jsx(ne,{size:18})})]},v)),o.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"لا يوجد فترات مضافة"})]}),e.jsx(F,{onClick:a,variant:"outline",className:"w-full",children:"إغلاق"})]})]}),document.body):null};function Ns({students:s,studentsCollection:a,groups:o=[],groupsCollection:x,selectedBranch:r}){const[c,l]=j.useState(new Date),[b,v]=j.useState(new Date().getDate()),[w,p]=j.useState(""),[i,N]=j.useState(1),[f,g]=j.useState(10),[m,I]=j.useState(!1),[d,$]=j.useState(!1),[u,S]=j.useState("الكل"),M=j.useMemo(()=>o?o.map(D=>D.name):[],[o]),L=async D=>{var R;if(M.includes(D))return alert("هذه الفترة موجودة مسبقاً");await x.add({name:D,branch:r||((R=s[0])==null?void 0:R.branch)||"عام"})},O=async D=>{confirm(`حذف الفترة "${D.name}"؟`)&&(await x.remove(D.id),u===D.name&&S("الكل"))},E=c.getFullYear(),n=c.getMonth(),k=new Date(E,n+1,0).getDate(),U=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],h=["أحد","إثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],A=Array.from({length:8},(D,R)=>2023+R),K=(D,R)=>{const q=new Date(c);D!==null&&q.setFullYear(D),R!==null&&q.setMonth(R),l(q),v(1)},_=D=>{const R=new Date(E,n+1,0).getDate();let q=b+D;q>R&&(q=R),q<1&&(q=1),v(q)},W=j.useMemo(()=>{let D=Array.isArray(s)?[...s]:[];return u!=="الكل"&&(D=D.filter(R=>R.group===u)),D.sort((R,q)=>(R.customOrder||999999)-(q.customOrder||999999)),w&&(D=D.filter(R=>R.name.toLowerCase().includes(w.toLowerCase()))),D},[s,w,u]),y=Math.ceil(W.length/f),G=m?W:W.slice((i-1)*f,i*f),X=async(D,R)=>{const q=`${E}-${String(n+1).padStart(2,"0")}-${String(R).padStart(2,"0")}`,t={...s.find(C=>C.id===D).attendance||{}};t[q]?delete t[q]:t[q]=!0,await a.update(D,{attendance:t})},ae=async(D,R)=>{let q=R-1;if(q<0&&(q=0),q>=W.length&&(q=W.length-1),q===D)return;const T=[...W],[t]=T.splice(D,1);T.splice(q,0,t);const C=T.map((P,H)=>a.update(P.id,{customOrder:H+1}));await Promise.all(C)},le=async(D,R)=>{confirm("هل أنت متأكد من نقل الطالب لهذه الفترة؟")&&await a.update(D,{group:R})},ce=()=>{const D=window.open("","PRINT","height=800,width=1200"),R=window.location.origin+de.LOGO;let q="";for(let C=1;C<=k;C++)q+=`<th style="font-size:10px; width:20px; border:1px solid #ccc; background:#f9f9f9;">${C}</th>`;let T="";W.forEach((C,P)=>{var Y;let H="";for(let Q=1;Q<=k;Q++){const B=`${E}-${String(n+1).padStart(2,"0")}-${String(Q).padStart(2,"0")}`,te=(Y=C.attendance)==null?void 0:Y[B],oe=new Date(E,n,Q).getDay()===5;let me="",z="";oe?z="#eee":te&&(me="✓",z="#dcfce7"),H+=`<td style="border:1px solid #ccc; background:${z}; text-align:center; font-size:12px; color:#166534; font-weight:bold;">${me}</td>`}T+=`
            <tr>
                <td style="border:1px solid #ccc; padding:5px; font-weight:bold; text-align:center;">${P+1}</td>
                <td style="border:1px solid #ccc; padding:5px; text-align:right;">${C.name}</td>
                <td style="border:1px solid #ccc; padding:5px; text-align:center; font-size:11px;">${C.group||"-"}</td>
                ${H}
            </tr>
        `});const t=`
      <!DOCTYPE html>
      <html lang="ar" dir="rtl">
        <head>
          <title>كشف الحضور - ${U[n]} ${E}</title>
          <style>
            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
            body { font-family: 'Cairo', sans-serif; padding: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            h1 { text-align: center; color: #b45309; margin-bottom: 5px; }
            .header-info { text-align: center; margin-bottom: 20px; font-weight:bold; color:#555; }
            @page { size: A4 landscape; margin: 10mm; }
          </style>
        </head>
        <body>
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #b45309; padding-bottom:10px;">
                <div>
                    <h1>أكاديمية الشجاع للتايكواندو</h1>
                    <div style="font-size:12px;">فرع: ${r}</div>
                </div>
                <img src="${R}" style="height:60px;" onerror="this.style.display='none'"/>
            </div>

            <div class="header-info">
                سجل الحضور والغياب | شهر: ${U[n]} ${E} | المجموعة: ${u}
            </div>

            <table>
                <thead>
                    <tr>
                        <th style="border:1px solid #ccc; background:#eee; width:30px;">#</th>
                        <th style="border:1px solid #ccc; background:#eee; width:200px;">اسم الطالب</th>
                        <th style="border:1px solid #ccc; background:#eee; width:80px;">المجموعة</th>
                        ${q}
                    </tr>
                </thead>
                <tbody>
                    ${T}
                </tbody>
            </table>
            
            <div style="margin-top:20px; font-size:10px; text-align:left; color:#777;">
                تاريخ الطباعة: ${new Date().toLocaleDateString("ar-JO")}
            </div>
        </body>
      </html>
    `;D.document.write(t),D.document.close(),D.onload=()=>{D.focus(),setTimeout(()=>{D.print(),D.close()},500)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in font-sans",children:[e.jsx(ys,{isOpen:d,onClose:()=>$(!1),groups:o||[],onAdd:L,onDelete:O}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col xl:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 bg-gray-50 p-2 rounded-xl border border-gray-200 justify-center w-full md:w-auto",children:[e.jsx(je,{size:18,className:"text-gray-500 ml-1"}),e.jsx("select",{className:"bg-transparent font-bold text-gray-700 outline-none cursor-pointer",value:n,onChange:D=>K(null,parseInt(D.target.value)),children:U.map((D,R)=>e.jsx("option",{value:R,children:D},R))}),e.jsx("select",{className:"bg-transparent font-bold text-gray-700 outline-none cursor-pointer",value:E,onChange:D=>K(parseInt(D.target.value),null),children:A.map(D=>e.jsx("option",{value:D,children:D},D))})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 p-2 pl-3 rounded-xl border border-blue-100 w-full md:w-auto",children:[e.jsx(Ne,{size:18,className:"text-blue-500 ml-1"}),e.jsx("span",{className:"text-xs font-bold text-blue-800 ml-1 hidden sm:inline",children:"الفترة:"}),e.jsx("div",{className:"relative group",children:e.jsxs("select",{className:"bg-transparent text-blue-900 font-bold outline-none w-full md:w-40 cursor-pointer appearance-none pr-4",value:u,onChange:D=>{S(D.target.value),N(1)},children:[e.jsx("option",{value:"الكل",children:"الكل (جميع الطلاب)"}),M.map((D,R)=>e.jsx("option",{value:D,children:D},R))]})}),e.jsx("button",{onClick:()=>$(!0),className:"bg-white p-1.5 rounded-lg text-blue-500 hover:text-blue-700 hover:shadow-sm border border-transparent hover:border-blue-200 transition-all",title:"إضافة/حذف فترات",children:e.jsx(Ge,{size:16})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 w-full xl:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(_e,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"بحث...",className:"w-full pl-4 pr-10 py-2.5 border-2 border-gray-100 rounded-xl focus:border-yellow-500 outline-none",value:w,onChange:D=>{p(D.target.value),N(1)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:m?"default":"outline",onClick:()=>I(!m),className:`gap-2 whitespace-nowrap ${m?"bg-yellow-500 text-black border-none":""}`,children:[m?e.jsx(wt,{size:18}):e.jsx(Vt,{size:18}),m?"حفظ الترتيب":"ترتيب"]}),e.jsxs(F,{onClick:ce,className:"bg-gray-800 text-white gap-2 hover:bg-black",title:"طباعة الكشف",children:[e.jsx(be,{size:18})," ",e.jsx("span",{className:"hidden md:inline",children:"طباعة"})]})]})]})]}),e.jsxs("div",{className:"md:hidden space-y-4",children:[e.jsxs("div",{className:"bg-yellow-500 text-black p-4 rounded-xl shadow-lg flex justify-between items-center",children:[e.jsx("button",{onClick:()=>_(-1),className:"p-2 bg-white/20 rounded-lg",children:e.jsx(Ue,{})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs opacity-75 font-bold mb-1",children:"تسجيل الحضور"}),e.jsx("div",{className:"text-xl font-bold flex flex-col",children:e.jsxs("span",{children:[b," ",U[n]]})})]}),e.jsx("button",{onClick:()=>_(1),className:"p-2 bg-white/20 rounded-lg",children:e.jsx(Ke,{})})]}),e.jsx("div",{className:"grid gap-3",children:G.map((D,R)=>{var C;const q=`${E}-${String(n+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`,T=!!((C=D.attendance)!=null&&C[q]),t=new Date(E,n,b).getDay()===5;return e.jsx("div",{className:"p-4 rounded-xl border border-gray-100 bg-white shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-500 text-sm",children:(i-1)*f+R+1}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:D.name}),e.jsx("div",{className:"relative mt-1",children:e.jsx("select",{className:"text-[10px] bg-blue-50 text-blue-700 px-2 py-0.5 rounded-md outline-none border-none font-bold w-full appearance-none",value:D.group||(M.length>0?M[0]:""),onChange:P=>le(D.id,P.target.value),children:M.map((P,H)=>e.jsx("option",{value:P,children:P},H))})})]})]}),!m&&(t?e.jsx("span",{className:"text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded",children:"عطلة"}):e.jsx("button",{onClick:()=>X(D.id,b),className:`w-10 h-10 rounded-full flex items-center justify-center ${T?"bg-green-500 text-white":"bg-gray-100 text-gray-300"}`,children:T?e.jsx(ut,{size:20}):e.jsx("span",{className:"w-3 h-3 bg-gray-300 rounded-full"})}))]})},D.id)})})]}),e.jsx(J,{className:"hidden md:block overflow-visible p-0 border-none shadow-md rounded-2xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-gray-800 text-white sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"p-4 sticky right-0 bg-gray-800 z-30 text-right min-w-[280px] font-bold text-base shadow-lg",children:["الطلاب ",u!=="الكل"&&e.jsxs("span",{className:"text-yellow-400 text-sm",children:["(",u,")"]})]}),!m&&[...Array(k)].map((D,R)=>{const q=R+1,T=new Date(E,n,q).getDay()===5;return e.jsx("th",{className:`p-2 border-l border-gray-700 text-center min-w-[40px] ${T?"bg-red-900/40 text-red-100":""}`,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"opacity-60 text-[10px]",children:h[new Date(E,n,q).getDay()]}),e.jsx("span",{children:q})]})},R)}),m&&e.jsx("th",{className:"p-4 text-center w-64 bg-yellow-600/90 text-white",children:"الترتيب"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:G.map((D,R)=>{const q=(i-1)*f+R+1;return e.jsxs("tr",{className:"hover:bg-yellow-50 transition-colors group",children:[e.jsx("td",{className:"p-3 sticky right-0 bg-white group-hover:bg-yellow-50 font-bold border-l border-gray-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] z-10 text-gray-800 text-sm flex items-center justify-between h-[50px]",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("span",{className:`text-xs w-6 h-6 flex items-center justify-center rounded-full font-mono ${m?"bg-yellow-100 text-yellow-800 font-bold":"bg-gray-100 text-gray-500"}`,children:q}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"truncate",children:D.name}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(Fe,{size:10,className:"text-gray-400"}),e.jsxs("select",{className:"bg-transparent text-[10px] text-gray-500 outline-none cursor-pointer hover:text-blue-600 w-full",value:D.group||(M.length>0?M[0]:""),onChange:T=>le(D.id,T.target.value),onClick:T=>T.stopPropagation(),children:[e.jsx("option",{value:"",disabled:!0,children:"نقل إلى..."}),M.map((T,t)=>e.jsx("option",{value:T,children:T},t))]})]})]})]})}),!m&&[...Array(k)].map((T,t)=>{var Q;const C=t+1,P=`${E}-${String(n+1).padStart(2,"0")}-${String(C).padStart(2,"0")}`,H=!!((Q=D.attendance)!=null&&Q[P]),Y=new Date(E,n,C).getDay()===5;return e.jsx("td",{className:`border-l border-gray-100 text-center p-0 ${Y?"bg-gray-50":""}`,children:Y?e.jsx("div",{className:"w-full h-full flex items-center justify-center opacity-20 pointer-events-none",children:e.jsx(xe,{size:12})}):e.jsxs("label",{className:"cursor-pointer w-full h-full flex items-center justify-center hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:()=>X(D.id,C),className:"hidden"}),e.jsx("div",{className:`w-6 h-6 rounded flex items-center justify-center transition-all ${H?"bg-green-500 text-white scale-110":"bg-gray-100 hover:bg-gray-300"}`,children:e.jsx(ut,{size:14})})]})},t)}),m&&e.jsx("td",{className:"p-2 text-center bg-yellow-50/20 border-l border-yellow-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-gray-400 text-xs",children:"رقم:"}),e.jsx("input",{type:"number",className:"w-20 p-2 text-center border-2 border-yellow-300 rounded-lg focus:border-yellow-600 outline-none font-bold text-lg",placeholder:q,onKeyDown:T=>{T.key==="Enter"&&(ae(R,parseInt(T.target.value)),T.target.value="",T.target.blur())},onBlur:T=>{T.target.value&&(ae(R,parseInt(T.target.value)),T.target.value="")}})]})})]},D.id)})})]})})}),!m&&y>1&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{children:"عرض"}),e.jsxs("select",{className:"bg-gray-50 border border-gray-200 rounded-lg p-1.5 focus:outline-none font-bold cursor-pointer",value:f,onChange:D=>{g(Number(D.target.value)),N(1)},children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:W.length,children:"الكل"})]}),e.jsxs("span",{children:["من أصل ",W.length," طالب"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",disabled:i===1,onClick:()=>N(D=>D-1),className:"px-4 text-sm",children:"السابق"}),e.jsx("div",{className:"flex gap-1 overflow-x-auto hide-scrollbar max-w-[150px] md:max-w-none px-1",children:[...Array(y)].map((D,R)=>e.jsx("button",{onClick:()=>N(R+1),className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-bold transition-all ${i===R+1?"bg-yellow-500 text-black shadow-md scale-105":"bg-gray-50 text-gray-600 hover:bg-gray-200"}`,children:R+1},R))}),e.jsx(F,{variant:"outline",disabled:i===y,onClick:()=>N(D=>D+1),className:"px-4 text-sm",children:"التالي"})]})]})]})}const vs=()=>{const a=`student${Math.floor(1e3+Math.random()*9e3)}`;let o="";const x="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";for(let r=0;r<8;r++)o+=x.charAt(Math.floor(Math.random()*x.length));return{username:a,password:o}},ws=s=>{if(!s)return"-";const a=new Date(s);if(isNaN(a.getTime()))return s;const o=String(a.getDate()).padStart(2,"0"),x=String(a.getMonth()+1).padStart(2,"0"),r=a.getFullYear();return`${o}/${x}/${r}`};function ks({registrations:s,students:a,registrationsCollection:o,studentsCollection:x,selectedBranch:r,logActivity:c}){const[l,b]=j.useState(null),[v,w]=j.useState({}),p=[...new Map(a.map(f=>[f.familyId,f.familyName])).entries()],i=f=>{const g=new Date().toISOString().split("T")[0],m=new Date;m.setMonth(m.getMonth()+1),w({name:f.name,phone:f.phone,dob:f.dob,address:f.address,belt:"أبيض",joinDate:g,subEnd:m.toISOString().split("T")[0],balance:0,linkFamily:"new"}),b(f)},N=async f=>{var u;f.preventDefault();const{username:g,password:m}=vs();let I,d;v.linkFamily==="new"?(I=Math.floor(Date.now()/1e3),d=`عائلة ${v.name.split(" ").slice(-1)[0]}`):(I=parseInt(v.linkFamily),d=((u=a.find(S=>S.familyId===I))==null?void 0:u.familyName)||"عائلة");const $={branch:r,status:"active",notes:[],internalNotes:[],attendance:{},username:g,password:m,familyId:I,familyName:d,customOrder:Date.now(),...v};delete $.linkFamily,await x.add($),await o.remove(l.id),c("تسجيل طالب",`تم قبول الطالب ${v.name}`),alert(`تم إضافة الطالب بنجاح!
User: ${g}
Pass: ${m}`),b(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4",children:s.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border-2 border-dashed border-gray-200",children:[e.jsx(Dt,{size:48,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد طلبات جديدة حالياً."})]}):s.map(f=>e.jsx(J,{className:"border-r-4 border-blue-500",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-lg flex items-center gap-2",children:[f.name," ",e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded",children:"جديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{size:14})," ",f.phone]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{size:14})," ",f.address]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{size:14})," ",ws(f.dob)]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx(F,{onClick:()=>i(f),className:"bg-green-600 hover:bg-green-700 text-white text-sm flex-1 md:flex-none",children:"اعتماد كطالب"}),e.jsx("button",{onClick:()=>{confirm("حذف الطلب؟")&&o.remove(f.id)},className:"text-red-500 p-2 hover:bg-red-50 rounded border border-red-200",children:e.jsx(ne,{size:18})})]})]})},f.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4 backdrop-blur-sm",children:e.jsx(J,{className:"w-full max-w-2xl animate-fade-in",title:"إكمال بيانات الطالب الجديد",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold",children:"الاسم"}),e.jsx("input",{className:"w-full border p-2 bg-gray-100 rounded text-gray-500",value:v.name,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold",children:"الهاتف"}),e.jsx("input",{className:"w-full border p-2 bg-gray-100 rounded text-gray-500",value:v.phone,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold",children:"العائلة"}),e.jsxs("select",{className:"w-full border p-2 rounded",value:v.linkFamily,onChange:f=>w({...v,linkFamily:f.target.value}),children:[e.jsx("option",{value:"new",children:"عائلة جديدة"}),p.map(([f,g])=>e.jsx("option",{value:f,children:g},f))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold",children:"الحزام"}),e.jsx("select",{className:"w-full border p-2 rounded",value:v.belt,onChange:f=>w({...v,belt:f.target.value}),children:V.map(f=>e.jsx("option",{children:f},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold",children:"تاريخ الالتحاق"}),e.jsx("input",{type:"date",className:"w-full border p-2 rounded",value:v.joinDate,onChange:f=>w({...v,joinDate:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 font-bold text-green-600",children:"نهاية الاشتراك"}),e.jsx("input",{type:"date",className:"w-full border p-2 rounded bg-green-50",value:v.subEnd,onChange:f=>w({...v,subEnd:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 text-red-600 font-bold",children:"رصيد مستحق (JOD)"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded focus:ring-2 ring-red-500 outline-none",value:v.balance,onChange:f=>w({...v,balance:f.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t",children:[e.jsx(F,{variant:"ghost",onClick:()=>b(null),children:"إلغاء"}),e.jsx(F,{type:"submit",children:"تأكيد وإضافة"})]})]})})})]})}function Ss({schedule:s,scheduleCollection:a}){const[o,x]=j.useState({level:"",days:"",time:"",branch:""}),r=async l=>{l.preventDefault(),await a.add({...o}),x({level:"",days:"",time:"",branch:""})},c=async l=>{confirm("حذف؟")&&await a.remove(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"إضافة حصة",children:e.jsxs("form",{onSubmit:r,className:"grid grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1",children:"المستوى"}),e.jsx("input",{className:"w-full border p-2 rounded",value:o.level,onChange:l=>x({...o,level:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1",children:"الأيام"}),e.jsx("input",{className:"w-full border p-2 rounded",value:o.days,onChange:l=>x({...o,days:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1",children:"الوقت"}),e.jsx("input",{className:"w-full border p-2 rounded",value:o.time,onChange:l=>x({...o,time:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1",children:"الفرع"}),e.jsx("input",{className:"w-full border p-2 rounded",value:o.branch,onChange:l=>x({...o,branch:l.target.value}),required:!0})]}),e.jsx(F,{type:"submit",children:"إضافة"})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.map(l=>e.jsxs("div",{className:"bg-white p-4 rounded border flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:l.level}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.days," | ",l.time]})]}),e.jsx("button",{onClick:()=>c(l.id),className:"text-red-500",children:e.jsx(ne,{size:16})})]},l.id))})]})}function Ds({captains:s,captainsCollection:a}){const[o,x]=j.useState({name:"",branch:se.SHAFA,username:"",password:"",salary:"",holidays:[],withdrawals:[]}),[r,c]=j.useState(null),l=async b=>{b.preventDefault(),r?(await a.update(r,o),c(null)):await a.add({...o,role:"captain"}),x({name:"",branch:se.SHAFA,username:"",password:"",salary:"",holidays:[],withdrawals:[]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"إدارة الكباتن",children:e.jsxs("form",{onSubmit:l,className:"grid gap-4 md:grid-cols-2",children:[e.jsx("input",{className:"border p-2 rounded",placeholder:"الاسم",value:o.name,onChange:b=>x({...o,name:b.target.value}),required:!0}),e.jsxs("select",{className:"border p-2 rounded",value:o.branch,onChange:b=>x({...o,branch:b.target.value}),children:[e.jsx("option",{value:se.SHAFA,children:"شفا بدران"}),e.jsx("option",{value:se.ABU_NSEIR,children:"أبو نصير"})]}),e.jsx("input",{className:"border p-2 rounded",placeholder:"User",value:o.username,onChange:b=>x({...o,username:b.target.value}),required:!0}),e.jsx("input",{className:"border p-2 rounded",placeholder:"Pass",value:o.password,onChange:b=>x({...o,password:b.target.value}),required:!0}),e.jsx("input",{className:"border p-2 rounded",type:"number",placeholder:"الراتب الأساسي",value:o.salary,onChange:b=>x({...o,salary:b.target.value})}),e.jsx(F,{type:"submit",children:r?"حفظ التعديل":"إضافة كابتن"})]})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.map(b=>e.jsx(J,{className:"border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex justify-between flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:b.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["الراتب: ",b.salary," | User: ",b.username," | Pass: ",b.password]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("button",{onClick:()=>{c(b.id),x(b)},className:"text-blue-500",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>a.remove(b.id),className:"text-red-500",children:e.jsx(ne,{size:16})})]})]})},b.id))})]})}const Cs=({news:s,newsCollection:a,selectedBranch:o})=>{const[x,r]=j.useState(!1),[c,l]=j.useState({title:"",desc:"",image:"",branch:o}),[b,v]=j.useState(null),[w,p]=j.useState(!1),i=g=>{const m=g.target.files[0];if(m){v(m);const I=new FileReader;I.onloadend=()=>{l({...c,image:I.result})},I.readAsDataURL(m)}},N=async g=>{g.preventDefault(),p(!0);try{let m="";if(b){const I=Rt(ls,`news/${Date.now()}_${b.name}`),d=await _t(I,b);m=await Ut(d.ref)}await Re(he(ee,"artifacts",ie,"public","data","news"),{title:c.title,desc:c.desc,branch:c.branch,image:m,createdAt:new Date().toISOString()}),alert("تم نشر الخبر بنجاح!"),r(!1),l({title:"",desc:"",image:"",branch:o}),v(null)}catch(m){console.error("Error adding news:",m),alert("حدث خطأ أثناء النشر، تأكد من الصلاحيات والاتصال.")}p(!1)},f=async g=>{confirm("هل أنت متأكد من حذف هذا الخبر؟")&&await nt(fe(ee,"artifacts",ie,"public","data","news",g))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-xl shadow-sm",children:[e.jsx("h2",{className:"font-bold text-lg",children:"إدارة الأخبار والإعلانات"}),e.jsxs(F,{onClick:()=>r(!0),children:[e.jsx(dt,{size:18})," خبر جديد"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(g=>e.jsxs(J,{className:"relative overflow-hidden group",children:[e.jsxs("div",{className:"aspect-video w-full bg-gray-100 relative",children:[g.image?e.jsx("img",{src:g.image,alt:g.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-300",children:e.jsx(Qt,{size:48})}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs(F,{variant:"danger",onClick:()=>f(g.id),children:[e.jsx(ne,{size:18})," حذف"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:g.title}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:g.desc}),e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded mt-2 inline-block",children:g.branch})]})]},g.id))}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsx(J,{className:"w-full max-w-lg",title:"إضافة خبر جديد",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold block mb-1",children:"عنوان الخبر"}),e.jsx("input",{required:!0,className:"w-full border p-2 rounded",value:c.title,onChange:g=>l({...c,title:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold block mb-1",children:"التفاصيل"}),e.jsx("textarea",{required:!0,className:"w-full border p-2 rounded h-24",value:c.desc,onChange:g=>l({...c,desc:g.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold block mb-1",children:"صورة الخبر"}),e.jsx("input",{type:"file",accept:"image/*",onChange:i,className:"w-full border p-2 rounded bg-gray-50"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"يفضل صور بالعرض (Landscape)"})]}),c.image&&e.jsx("img",{src:c.image,alt:"preview",className:"w-full h-32 object-cover rounded border"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(F,{variant:"ghost",onClick:()=>r(!1),children:"إلغاء"}),e.jsx(F,{type:"submit",disabled:w,children:w?"جاري الرفع...":"نشر"})]})]})})})]})},ft=s=>s?s.includes("أبيض")?"bg-white text-gray-800 border-gray-200 border":s.includes("أصفر")?"bg-yellow-300 text-yellow-900 border-yellow-400":s.includes("أخضر")?"bg-green-600 text-white border-green-700":s.includes("أزرق")?"bg-blue-600 text-white border-blue-700":s.includes("بني")?"bg-[#8B4513] text-white border-[#5D2906]":s.includes("أحمر")?"bg-red-600 text-white border-red-700":s.includes("أسود")?"bg-black text-white border-gray-800":"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-800 border-gray-200";function $s({students:s,studentsCollection:a,logActivity:o}){const[x,r]=j.useState(""),[c,l]=j.useState("dateAsc"),b=async i=>{const N=V.indexOf(i.belt);if(N===-1||N>=V.length-1)return alert("هذا الطالب في أعلى حزام مسجل أو الحزام غير معروف");const f=V[N+1];confirm(`هل أنت متأكد من ترفيع ${i.name} إلى الحزام (${f})؟`)&&(await a.update(i.id,{belt:f}),o&&o("ترفيع حزام",`تم ترفيع ${i.name} إلى ${f}`))},v=async(i,N)=>{i.belt!==N&&confirm(`تغيير حزام الطالب ${i.name} يدوياً إلى ${N}؟`)&&(await a.update(i.id,{belt:N}),o&&o("تعديل حزام يدوي",`تغيير حزام ${i.name} من ${i.belt} إلى ${N}`))},w=async(i,N)=>{await a.update(i,{nextTestDate:N})},p=j.useMemo(()=>{let i=[...s];return x&&(i=i.filter(N=>N.name.toLowerCase().includes(x.toLowerCase()))),i.sort((N,f)=>{if(c==="dateAsc"||c==="dateDesc"){const g=N.nextTestDate?new Date(N.nextTestDate):new Date("2099-12-31"),m=f.nextTestDate?new Date(f.nextTestDate):new Date("2099-12-31");return c==="dateAsc"?g-m:m-g}return c==="beltAsc"?V.indexOf(N.belt)-V.indexOf(f.belt):c==="beltDesc"?V.indexOf(f.belt)-V.indexOf(N.belt):0}),i},[s,x,c]);return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-20 md:pb-0",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-4 justify-between items-center sticky top-0 z-20",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx(_e,{size:18,className:"absolute top-1/2 -translate-y-1/2 right-3 text-gray-400 pointer-events-none"}),e.jsx("input",{className:"w-full pl-4 pr-10 py-2.5 border-2 border-gray-100 rounded-xl focus:border-yellow-500 outline-none transition-all",placeholder:"ابحث عن اسم الطالب...",value:x,onChange:i=>r(i.target.value)})]}),e.jsx("div",{className:"flex items-center gap-2 w-full md:w-auto",children:e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsxs("select",{className:"w-full appearance-none bg-gray-50 border border-gray-200 text-gray-700 py-2.5 pr-10 pl-4 rounded-xl focus:outline-none focus:border-yellow-500 cursor-pointer text-sm font-bold",value:c,onChange:i=>l(i.target.value),children:[e.jsx("option",{value:"dateAsc",children:"📅 تاريخ الفحص (الأقرب أولاً)"}),e.jsx("option",{value:"dateDesc",children:"📅 تاريخ الفحص (الأبعد أولاً)"}),e.jsx("option",{value:"beltDesc",children:"🥋 ترتيب الأحزمة (من الأعلى)"}),e.jsx("option",{value:"beltAsc",children:"🥋 ترتيب الأحزمة (من المبتدئ)"})]}),e.jsx(kt,{size:16,className:"absolute top-1/2 -translate-y-1/2 right-3 text-gray-500 pointer-events-none"})]})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(J,{className:"p-0 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"الطالب"}),e.jsx("th",{className:"p-4",children:"الحزام الحالي (تعديل يدوي)"}),e.jsx("th",{className:"p-4",children:"تاريخ الفحص القادم"}),e.jsx("th",{className:"p-4 text-center",children:"إجراءات سريعة"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:p.map(i=>{const f=V.indexOf(i.belt)>=V.length-1;return e.jsxs("tr",{className:"hover:bg-yellow-50/30 transition-colors",children:[e.jsx("td",{className:"p-4 font-bold text-gray-800",children:i.name}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"relative w-fit",children:[e.jsx("select",{className:`appearance-none pl-8 pr-3 py-1.5 rounded-lg font-bold text-xs shadow-sm border cursor-pointer outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-400 ${ft(i.belt)}`,value:i.belt,onChange:g=>v(i,g.target.value),children:V.map(g=>e.jsx("option",{value:g,className:"bg-white text-gray-800",children:g},g))}),e.jsx(Fe,{size:12,className:"absolute top-1/2 -translate-y-1/2 left-2 opacity-50 pointer-events-none"})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 w-fit p-1 rounded-lg border border-gray-200 hover:border-yellow-400 transition-colors",children:[e.jsx(je,{size:16,className:"text-gray-400 mr-1"}),e.jsx("input",{type:"date",className:"bg-transparent outline-none text-gray-700 font-mono text-xs cursor-pointer focus:text-black",value:i.nextTestDate||"",onChange:g=>w(i.id,g.target.value)})]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("button",{onClick:()=>b(i),disabled:f,className:`flex items-center gap-1 px-4 py-2 rounded-xl text-xs font-bold transition-all mx-auto
                                                    ${f?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-100 text-green-700 hover:bg-green-600 hover:text-white hover:shadow-lg hover:shadow-green-500/20"}`,title:"ترفيع للحزام التالي مباشرة",children:[f?e.jsx(ve,{size:14}):e.jsx(Ee,{size:14}),f?"أعلى رتبة":"ترفيع تلقائي"]})})]},i.id)})})]})})}),e.jsx("div",{className:"md:hidden grid gap-4",children:p.map(i=>{const f=V.indexOf(i.belt)>=V.length-1;return e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:i.name}),e.jsxs("div",{className:"mt-2 relative inline-block",children:[e.jsx("select",{className:`appearance-none pl-8 pr-4 py-1 rounded text-[10px] font-bold border w-full ${ft(i.belt)}`,value:i.belt,onChange:g=>v(i,g.target.value),children:V.map(g=>e.jsx("option",{value:g,className:"bg-white text-gray-800",children:g},g))}),e.jsx(Fe,{size:10,className:"absolute top-1/2 -translate-y-1/2 left-2 opacity-50 pointer-events-none"})]})]}),e.jsx("div",{className:"text-gray-400 bg-gray-50 p-2 rounded-full",children:e.jsx(Ct,{size:20})})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl border border-gray-100",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:"تاريخ الفحص القادم"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:16,className:"text-gray-400"}),e.jsx("input",{type:"date",className:"bg-transparent w-full outline-none text-gray-800 font-bold text-sm",value:i.nextTestDate||"",onChange:g=>w(i.id,g.target.value)})]})]}),e.jsxs("button",{onClick:()=>b(i),disabled:f,className:`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all
                                    ${f?"bg-gray-100 text-gray-400":"bg-green-600 text-white shadow-lg shadow-green-600/20 active:scale-95"}`,children:[f?e.jsx(ve,{size:18}):e.jsx(Ee,{size:18}),f?"وصل لأعلى رتبة":"ترفيع للحزام التالي"]})]},i.id)})}),p.length===0&&e.jsx("div",{className:"text-center py-10 text-gray-400",children:"لا يوجد طلاب مطابقين للبحث"})]})}function zs({students:s,payments:a,expenses:o,activityLogs:x,registrations:r,adminNotes:c,selectedBranch:l}){const b=new Date,v=new Date(b.getFullYear(),b.getMonth(),1).toISOString().split("T")[0],w=new Date().toISOString().split("T")[0],[p,i]=j.useState(v),[N,f]=j.useState(w),g=n=>{if(!n)return"-";const k=new Date(n);if(isNaN(k.getTime()))return n;const U=String(k.getDate()).padStart(2,"0"),h=String(k.getMonth()+1).padStart(2,"0"),A=k.getFullYear();return`${U}/${h}/${A}`},m=n=>{if(!n)return!1;const k=new Date(n);k.setHours(0,0,0,0);const U=new Date(p);U.setHours(0,0,0,0);const h=new Date(N);return h.setHours(0,0,0,0),k>=U&&k<=h},I=n=>{if(!n)return{label:"منتهي",color:"#fee2e2",text:"#991b1b"};const k=new Date,U=new Date(n);k.setHours(0,0,0,0),U.setHours(0,0,0,0);const h=U-k,A=Math.ceil(h/(1e3*60*60*24));return A<0?{label:"منتهي",color:"#fee2e2",text:"#991b1b"}:A<=7?{label:"قارب الانتهاء",color:"#ffedd5",text:"#9a3412"}:{label:"فعال",color:"#dcfce7",text:"#166534"}},d=a.filter(n=>n.branch===l&&m(n.date)),$=o.filter(n=>n.branch===l&&m(n.date)),u=d.reduce((n,k)=>n+(Number(k.amount)||0),0),S=$.reduce((n,k)=>n+(Number(k.amount)||0),0),M=u-S,L=c||[],O=s.filter(n=>n.branch===l).map(n=>{let k=0;n.attendance&&Object.keys(n.attendance).forEach(_=>{m(_)&&k++});const U=a.filter(_=>_.studentId===n.id||_.name===n.name).sort((_,W)=>new Date(W.date)-new Date(_.date)),h=U.length>0?U[0].date:"-";let A=[];n.note&&A.push(`[قديم: ${n.note}]`),n.notes&&n.notes.length>0&&n.notes.forEach(_=>A.push(_.text)),n.internalNotes&&n.internalNotes.length>0&&n.internalNotes.forEach(_=>A.push(`(خاص: ${_.text})`));const K=A.join(" | ");return{...n,attendanceCount:k,lastPaymentDate:h,notesString:K||"-",statusInfo:I(n.subEnd)}}),E=()=>{const n=window.open("","PRINT","height=800,width=1000"),k=window.location.origin+de.LOGO,U=`
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>التقرير الشامل - ${l}</title>
                <style>
                    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
                    body { font-family: 'Cairo', sans-serif; padding: 15px; color: #1f2937; font-size: 10px; }
                    .header { text-align: center; border-bottom: 2px solid #fbbf24; padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
                    .header-content { text-align: center; flex: 1; }
                    .logo { height: 60px; object-fit: contain; }
                    h1 { margin: 0; color: #000; font-size: 18px; }
                    h2 { font-size: 14px; background: #f3f4f6; padding: 6px 10px; margin-top: 20px; border-right: 4px solid #000; font-weight: 700; }
                    
                    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
                    th, td { border: 1px solid #ccc; padding: 5px; text-align: right; vertical-align: middle; }
                    th { background-color: #f9fafb; font-weight: 700; white-space: nowrap; font-size: 10px; }
                    td { font-size: 10px; }
                    
                    .financial-grid { display: flex; gap: 15px; }
                    .box { flex: 1; border: 1px solid #ddd; padding: 8px; text-align: center; border-radius: 5px; }
                    .amount { font-size: 14px; font-weight: bold; display: block; margin-bottom: 2px; }
                    
                    .status-badge { padding: 2px 6px; border-radius: 4px; font-weight: bold; display: inline-block; font-size: 9px; }
                    
                    @media print {
                        @page { size: A4 landscape; margin: 10mm; }
                        body { -webkit-print-color-adjust: exact; }
                        button { display: none; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <div style="font-size:10px; text-align:right;">
                        التاريخ: ${g(new Date)}<br>
                        الفرع: <strong>${l}</strong>
                    </div>
                    <div class="header-content">
                        <h1>التقرير الإداري والمالي الشامل</h1>
                        <p style="margin:2px 0 0 0; color:#666;">الفترة: من ${g(p)} إلى ${g(N)}</p>
                    </div>
                    <img src="${k}" class="logo" onerror="this.style.display='none'"/>
                </div>

                <h2>أولاً: الوضع المالي (خلال الفترة المحددة)</h2>
                <div class="financial-grid">
                    <div class="box" style="background:#f0fdf4; border-color:#86efac;">
                        <span class="amount" style="color:#166534;">${u} JD</span>
                        <span>مجموع الإيرادات</span>
                    </div>
                    <div class="box" style="background:#fef2f2; border-color:#fca5a5;">
                        <span class="amount" style="color:#991b1b;">${S} JD</span>
                        <span>مجموع المصاريف</span>
                    </div>
                    <div class="box" style="background:#eff6ff; border-color:#93c5fd;">
                        <span class="amount" style="color:#1e40af;">${M} JD</span>
                        <span>صافي الربح</span>
                    </div>
                </div>

                <div class="financial-grid" style="margin-top:10px;">
                    <div style="flex:1;">
                        <h3 style="margin:5px 0; font-size:11px; color:green;">تفاصيل الوصولات (الواردات)</h3>
                        <table>
                            <thead><tr><th>التاريخ</th><th>الطالب</th><th>المبلغ</th><th>البيان</th></tr></thead>
                            <tbody>
                                ${d.map(h=>`<tr><td>${g(h.date)}</td><td>${h.name}</td><td>${h.amount}</td><td>${h.reason||"-"}</td></tr>`).join("")}
                                ${d.length===0?'<tr><td colspan="4" style="text-align:center">-</td></tr>':""}
                            </tbody>
                        </table>
                    </div>
                    <div style="flex:1;">
                        <h3 style="margin:5px 0; font-size:11px; color:red;">تفاصيل المصاريف</h3>
                        <table>
                            <thead><tr><th>التاريخ</th><th>البند</th><th>المبلغ</th></tr></thead>
                            <tbody>
                                ${$.map(h=>`<tr><td>${g(h.date)}</td><td>${h.title}</td><td>${h.amount}</td></tr>`).join("")}
                                ${$.length===0?'<tr><td colspan="3" style="text-align:center">-</td></tr>':""}
                            </tbody>
                        </table>
                    </div>
                </div>

                <h2>ثانياً: ملاحظات الإدارة (النشطة حالياً)</h2>
                <table>
                    <thead><tr><th width="15%">تاريخ الإضافة</th><th>الملاحظة</th></tr></thead>
                    <tbody>
                        ${L.map(h=>`<tr><td>${g(h.date)}</td><td>${h.text||h.content}</td></tr>`).join("")}
                        ${L.length===0?'<tr><td colspan="2" style="text-align:center">لا يوجد ملاحظات إدارية</td></tr>':""}
                    </tbody>
                </table>

                <h2>ثالثاً: سجل الطلاب الشامل (الوضع الحالي)</h2>
                <table>
                    <thead>
                        <tr>
                            <th width="2%">#</th>
                            <th width="12%">اسم الطالب</th>
                            <th width="6%">الحزام</th>
                            <th width="8%">حالة الاشتراك</th>
                            <th width="8%">ينتهي في</th>
                            <th width="8%">الوضع المالي</th>
                            <th width="8%">آخر وصل</th>
                            <th width="5%">حضور*</th>
                            <th width="8%">فحص قادم</th>
                            <th>الملاحظات (كل الأنواع)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${O.map((h,A)=>`
                            <tr>
                                <td>${A+1}</td>
                                <td style="font-weight:bold;">${h.name}</td>
                                <td>${h.belt}</td>
                                <td style="text-align:center;">
                                    <span class="status-badge" style="background:${h.statusInfo.color}; color:${h.statusInfo.text};">
                                        ${h.statusInfo.label}
                                    </span>
                                </td>
                                <td>${g(h.subEnd)}</td>
                                <td>
                                    ${Number(h.balance)>0?`<span style="color:red; font-weight:bold;">عليه ${h.balance}</span>`:'<span style="color:green;">مدفوع</span>'}
                                </td>
                                <td>${g(h.lastPaymentDate)}</td>
                                <td style="text-align:center; font-weight:bold;">${h.attendanceCount}</td>
                                <td>${g(h.nextTestDate)}</td>
                                <td style="font-size:9px; color:#555;">${h.notesString}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <p style="font-size:9px; margin-top:5px;">* عدد أيام الحضور يتم حسابه بناءً على الفترة المختارة في التقرير فقط.</p>

                <script>window.onload = function() { window.print(); }<\/script>
            </body>
            </html>
        `;n.document.write(U),n.document.close()};return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-20 md:pb-0",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 sticky top-0 z-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-gray-800 flex items-center gap-2",children:[e.jsx(we,{className:"text-yellow-500"})," التقارير الشاملة"]}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"يظهر التقرير جميع الملاحظات الحالية، بينما يتم فلترة البيانات المالية والحضور حسب التاريخ."})]}),e.jsxs("button",{onClick:E,className:"bg-gray-900 text-white px-6 py-2.5 rounded-xl font-bold flex items-center gap-2 hover:bg-black shadow-lg hover:shadow-xl transition-all w-full md:w-auto justify-center",children:[e.jsx(be,{size:18})," طباعة التقرير (PDF)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-3 rounded-xl border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"من تاريخ (للمالية والحضور)"}),e.jsx("input",{type:"date",value:p,onChange:n=>i(n.target.value),className:"w-full p-2 rounded-lg border-2 border-gray-200 outline-none focus:border-yellow-500 font-bold text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"إلى تاريخ (للمالية والحضور)"}),e.jsx("input",{type:"date",value:N,onChange:n=>f(n.target.value),className:"w-full p-2 rounded-lg border-2 border-gray-200 outline-none focus:border-yellow-500 font-bold text-sm"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(J,{className:"border-green-100 bg-green-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg text-green-600",children:e.jsx(Ce,{size:20})}),e.jsx("h3",{className:"font-bold text-gray-600 text-sm",children:"الإيرادات"})]}),e.jsxs("p",{className:"text-2xl font-black text-green-700",children:[u," JD"]})]}),e.jsxs(J,{className:"border-red-100 bg-red-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg text-red-600",children:e.jsx(lt,{size:20})}),e.jsx("h3",{className:"font-bold text-gray-600 text-sm",children:"المصاريف"})]}),e.jsxs("p",{className:"text-2xl font-black text-red-700",children:[S," JD"]})]}),e.jsxs(J,{className:"border-blue-100 bg-blue-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(Ce,{size:20})}),e.jsx("h3",{className:"font-bold text-gray-600 text-sm",children:"صافي الربح"})]}),e.jsxs("p",{className:"text-2xl font-black text-blue-700",children:[M," JD"]})]}),e.jsxs(J,{className:"border-yellow-100 bg-yellow-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg text-yellow-600",children:e.jsx(Ne,{size:20})}),e.jsx("h3",{className:"font-bold text-gray-600 text-sm",children:"الطلاب (الفرع)"})]}),e.jsx("p",{className:"text-2xl font-black text-yellow-700",children:O.length})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-50 bg-gray-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-green-700 flex items-center gap-2",children:[e.jsx(Ce,{size:18})," الإيرادات"]}),e.jsxs("span",{className:"text-xs font-bold bg-green-100 text-green-800 px-2 py-1 rounded-full",children:[d.length," وصل"]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-xs text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"الطالب"}),e.jsx("th",{className:"p-3",children:"المبلغ"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[d.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-500",children:g(n.date)}),e.jsx("td",{className:"p-3 font-bold text-gray-700",children:n.name}),e.jsx("td",{className:"p-3 font-bold text-green-600",children:n.amount})]},n.id)),d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"p-4 text-center text-gray-400",children:"لا يوجد إيرادات"})})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-50 bg-gray-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-red-700 flex items-center gap-2",children:[e.jsx(lt,{size:18})," المصاريف"]}),e.jsxs("span",{className:"text-xs font-bold bg-red-100 text-red-800 px-2 py-1 rounded-full",children:[$.length," حركة"]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-xs text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"البند"}),e.jsx("th",{className:"p-3",children:"المبلغ"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[$.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-500",children:g(n.date)}),e.jsx("td",{className:"p-3 font-bold text-gray-700",children:n.title}),e.jsx("td",{className:"p-3 font-bold text-red-600",children:n.amount})]},n.id)),$.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"p-4 text-center text-gray-400",children:"لا يوجد مصاريف"})})]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-50 bg-yellow-50/50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-yellow-800 flex items-center gap-2",children:[e.jsx(Zt,{size:18})," ملاحظات الإدارة (الكل)"]}),e.jsxs("span",{className:"text-xs font-bold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:[L.length," ملاحظة"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto custom-scrollbar p-0",children:e.jsxs("table",{className:"w-full text-xs text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-32",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"الملاحظة"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[L.map((n,k)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-500",children:g(n.date)}),e.jsx("td",{className:"p-3 text-gray-700",children:n.text||n.content})]},k)),L.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"2",className:"p-4 text-center text-gray-400",children:"لا يوجد ملاحظات إدارية"})})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-50 bg-blue-50/50 flex justify-between items-center",children:e.jsxs("h3",{className:"font-bold text-blue-800 flex items-center gap-2",children:[e.jsx(Ne,{size:18})," سجل الطلاب الشامل"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"#"}),e.jsx("th",{className:"p-3",children:"الطالب"}),e.jsx("th",{className:"p-3",children:"الحزام"}),e.jsx("th",{className:"p-3",children:"الاشتراك"}),e.jsx("th",{className:"p-3",children:"الانتهاء"}),e.jsx("th",{className:"p-3",children:"المالية"}),e.jsx("th",{className:"p-3",children:"آخر وصل"}),e.jsx("th",{className:"p-3",children:"الحضور"}),e.jsx("th",{className:"p-3",children:"ملاحظات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:O.map((n,k)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-400",children:k+1}),e.jsx("td",{className:"p-3 font-bold text-gray-800",children:n.name}),e.jsx("td",{className:"p-3 text-gray-600",children:n.belt}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${n.statusInfo.color} ${n.statusInfo.text}`,children:n.statusInfo.label})}),e.jsx("td",{className:"p-3 dir-ltr text-right text-gray-500",children:g(n.subEnd)}),e.jsx("td",{className:"p-3",children:Number(n.balance)>0?e.jsxs("span",{className:"text-red-600 font-bold bg-red-50 px-2 py-0.5 rounded",children:["عليه ",n.balance]}):e.jsx("span",{className:"text-green-600",children:"مدفوع"})}),e.jsx("td",{className:"p-3 text-gray-500",children:g(n.lastPaymentDate)}),e.jsx("td",{className:"p-3 font-bold text-center",children:n.attendanceCount}),e.jsx("td",{className:"p-3 text-gray-500 max-w-xs truncate",title:n.notesString,children:n.notesString!=="-"?n.notesString:""})]},n.id))})]})})]})]})}const ge=s=>{if(!s)return"-";const a=new Date(s);if(isNaN(a.getTime()))return s;const o=String(a.getDate()).padStart(2,"0"),x=String(a.getMonth()+1).padStart(2,"0"),r=a.getFullYear();return`${o}/${x}/${r}`},He=s=>{if(!s)return"expired";const a=new Date,o=new Date(s);a.setHours(0,0,0,0),o.setHours(0,0,0,0);const x=o-a,r=Math.ceil(x/(1e3*60*60*24));return r<0?"expired":r<=7?"near_end":"active"},Is=s=>{switch(s){case"active":return"فعال (Working)";case"near_end":return"قارب على الانتهاء (About to finish)";case"expired":return"منتهي (Finished)";default:return"-"}};function As({students:s,studentsCollection:a,logActivity:o,selectedBranch:x}){const[r,c]=j.useState(null),[l,b]=j.useState("all"),[v,w]=j.useState(null),[p,i]=j.useState(""),N=async(d,$)=>{const u=d.subEnd?new Date(d.subEnd):new Date,S=new Date(u);S.setMonth(S.getMonth()+$);const M=S.toISOString().split("T")[0],L=d.subEnd?ge(d.subEnd):"اليوم",O=ge(M);window.confirm(`تجديد اشتراك ${d.name} لمدة ${$} شهر؟
من: ${L}
إلى: ${O}`)&&(await a.update(d.id,{subEnd:M}),o&&o("تجديد سريع",`تجديد اشتراك للطالب ${d.name} (+${$} شهر) ليصبح ${O}`))},f=async d=>{if(!p)return;const $=s.find(S=>S.id===d),u=$?$.name:"طالب غير معروف";await a.update(d,{subEnd:p}),o&&o("تعديل اشتراك",`تعديل تاريخ اشتراك للطالب ${u} يدوياً إلى ${ge(p)}`),w(null)},g=d=>{w(d.id),i(d.subEnd||new Date().toISOString().split("T")[0])},m=j.useMemo(()=>s.filter(d=>{const $=r?d.id===r:!0,u=He(d.subEnd);return $&&(l==="all"||u===l)}).sort((d,$)=>new Date(d.subEnd||0)-new Date($.subEnd||0)),[s,r,l]),I=()=>{const d=window.open("","PRINT","height=800,width=1000"),$=window.location.origin+de.LOGO,u=ge(new Date),S=`
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>تقرير الاشتراكات - ${x||""}</title>
                <style>
                    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
                    body { font-family: 'Cairo', sans-serif; padding: 20px; }
                    .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                    .logo { height: 80px; margin-bottom: 10px; }
                    table { width: 100%; border-collapse: collapse; font-size: 12px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                    th { background-color: #f3f4f6; }
                    .status-active { color: green; font-weight: bold; }
                    .status-near_end { color: orange; font-weight: bold; }
                    .status-expired { color: red; font-weight: bold; }
                    @media print { button { display: none; } }
                </style>
            </head>
            <body>
                <div class="header">
                    <img src="${$}" class="logo" onerror="this.style.display='none'"/>
                    <h2>تقرير متابعة الاشتراكات</h2>
                    <p>التاريخ: ${u}</p>
                    <p>عدد الطلاب في القائمة: ${m.length}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>الطالب</th>
                            <th>الحزام</th>
                            <th>تاريخ الانتهاء</th>
                            <th>الحالة</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${m.map((M,L)=>{const O=He(M.subEnd),E=Is(O),n=`status-${O}`;return`
                                <tr>
                                    <td>${L+1}</td>
                                    <td>${M.name}</td>
                                    <td>${M.belt}</td>
                                    <td style="direction:ltr; text-align:right">${ge(M.subEnd)}</td>
                                    <td class="${n}">${E}</td>
                                </tr>
                            `}).join("")}
                    </tbody>
                </table>
                <script>window.onload = function() { window.print(); }<\/script>
            </body>
            </html>
        `;d.document.write(S),d.document.close()};return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-20 md:pb-0",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-4 justify-between items-end sticky top-0 z-20",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"بحث عن طالب (Thinker Search)"}),e.jsx(Ye,{students:s,onSelect:d=>c(d.id),onClear:()=>c(null),placeholder:"اكتب اسم الطالب...",showAllOption:!0})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${l==="all"?"bg-gray-800 text-white":"bg-gray-100 text-gray-600"}`,children:"الكل"}),e.jsx("button",{onClick:()=>b("active"),className:`px-4 py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${l==="active"?"bg-green-600 text-white":"bg-green-50 text-green-600"}`,children:"ساري المفعول"}),e.jsx("button",{onClick:()=>b("near_end"),className:`px-4 py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${l==="near_end"?"bg-orange-500 text-white":"bg-orange-50 text-orange-600"}`,children:"قرب ينتهي"}),e.jsx("button",{onClick:()=>b("expired"),className:`px-4 py-2.5 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${l==="expired"?"bg-red-600 text-white":"bg-red-50 text-red-600"}`,children:"منتهي"})]}),e.jsxs(F,{onClick:I,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200",children:[e.jsx(be,{size:18,className:"ml-2"})," طباعة القائمة"]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(J,{noPadding:!0,children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"الطالب"}),e.jsx("th",{className:"p-4",children:"الحالة"}),e.jsx("th",{className:"p-4",children:"تاريخ الانتهاء الحالي"}),e.jsx("th",{className:"p-4 text-center",children:"تجديد سريع"}),e.jsx("th",{className:"p-4 text-center",children:"تعديل يدوي"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[m.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"p-4 font-bold text-gray-800",children:d.name}),e.jsx("td",{className:"p-4",children:e.jsx(Le,{status:He(d.subEnd)})}),e.jsx("td",{className:"p-4 font-mono text-gray-600 dir-ltr text-right",children:ge(d.subEnd)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>N(d,1),className:"bg-green-50 hover:bg-green-100 text-green-700 px-3 py-1 rounded-lg text-xs font-bold transition border border-green-200",children:"+1 شهر"}),e.jsx("button",{onClick:()=>N(d,2),className:"bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold transition border border-blue-200",children:"+2 شهر"}),e.jsx("button",{onClick:()=>N(d,3),className:"bg-purple-50 hover:bg-purple-100 text-purple-700 px-3 py-1 rounded-lg text-xs font-bold transition border border-purple-200",children:"+3 شهر"})]})}),e.jsx("td",{className:"p-4 text-center",children:v===d.id?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("input",{type:"date",className:"border rounded p-1 text-xs",value:p,onChange:$=>i($.target.value)}),e.jsx("button",{onClick:()=>f(d.id),className:"text-green-600 hover:bg-green-50 p-1 rounded",children:e.jsx(ve,{size:18})}),e.jsx("button",{onClick:()=>w(null),className:"text-red-500 hover:bg-red-50 p-1 rounded",children:e.jsx(Xt,{size:18})})]}):e.jsx("button",{onClick:()=>g(d),className:"text-gray-400 hover:text-blue-600 flex items-center justify-center gap-1 mx-auto",children:e.jsx(Fe,{size:16})})})]},d.id)),m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center p-8 text-gray-400",children:"لا يوجد طلاب مطابقين للبحث"})})]})]})})}),e.jsxs("div",{className:"md:hidden grid gap-4",children:[m.map(d=>{const $=He(d.subEnd);return e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${$==="active"?"bg-green-500":$==="near_end"?"bg-orange-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-4 pl-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:d.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-gray-500 text-xs",children:[e.jsx(qe,{size:12})," ينتهي: ",ge(d.subEnd)]})]}),e.jsx(Le,{status:$})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsx("button",{onClick:()=>N(d,1),className:"bg-green-50 text-green-700 py-2 rounded-lg text-xs font-bold border border-green-100 hover:bg-green-100",children:"+ شهر"}),e.jsx("button",{onClick:()=>N(d,2),className:"bg-blue-50 text-blue-700 py-2 rounded-lg text-xs font-bold border border-blue-100 hover:bg-blue-100",children:"+ شهرين"}),e.jsx("button",{onClick:()=>N(d,3),className:"bg-purple-50 text-purple-700 py-2 rounded-lg text-xs font-bold border border-purple-100 hover:bg-purple-100",children:"+ 3 شهور"})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 whitespace-nowrap",children:"تعديل يدوي:"}),e.jsx("input",{type:"date",className:"flex-1 bg-white border border-gray-200 rounded p-1 text-xs outline-none focus:border-blue-500",defaultValue:d.subEnd,onBlur:u=>{u.target.value!==d.subEnd&&window.confirm(`حفظ التاريخ الجديد (${ge(u.target.value)})؟`)&&a.update(d.id,{subEnd:u.target.value})}})]})]},d.id)}),m.length===0&&e.jsx("div",{className:"text-center p-10 text-gray-400 bg-white rounded-xl border border-dashed",children:"لا يوجد نتائج"})]})]})}function Ms({students:s,studentsCollection:a,logActivity:o,selectedBranch:x}){const[r,c]=j.useState(null),[l,b]=j.useState(""),[v,w]=j.useState("private"),[p,i]=j.useState(null),N=u=>{if(!u)return[];let S=[];u.note&&typeof u.note=="string"&&u.note.trim()!==""&&S.push({id:"legacy_note",text:u.note,type:"private",date:"سجل قديم",isLegacy:!0});const M=u.notes||[],L=u.internalNotes||[];if(Array.isArray(M)&&(S=[...S,...M]),Array.isArray(L)){const O=new Set(S.map(E=>E.id));L.forEach(E=>{O.has(E.id)||S.push({...E,type:"private"})})}return S.sort((O,E)=>O.isLegacy?1:E.isLegacy?-1:E.id>O.id?1:-1)},f=j.useMemo(()=>s.filter(u=>{const S=u.note&&u.note.trim().length>0,M=u.notes&&u.notes.length>0||u.internalNotes&&u.internalNotes.length>0;return S||M}),[s]),g=async()=>{if(!r||!l.trim())return;let u={};if(p)p.isLegacy?(u={note:l},o("تعديل ملاحظة",`تعديل الملاحظة الرئيسية للطالب ${r.name}`)):(u={notes:(r.notes||[]).map(L=>L.id===p.id?{...L,text:l,type:v}:L)},o("تعديل ملاحظة",`تعديل ملاحظة في السجل للطالب ${r.name}`));else{const S={id:Date.now().toString(),text:l,type:v,date:new Date().toISOString().split("T")[0],branch:x},M=r.notes||[];u={notes:[S,...M]},o("ملاحظة جديدة",`إضافة ملاحظة (${v==="private"?"خاصة":"عامة"}) للطالب ${r.name}`)}await a.update(r.id,u),c(S=>({...S,...u})),b(""),i(null),w("private")},m=async u=>{if(!confirm("هل أنت متأكد من حذف هذه الملاحظة نهائياً؟"))return;let S={};if(u.isLegacy)S={note:""};else if(S={notes:(r.notes||[]).filter(O=>O.id!==u.id)},r.internalNotes){const O=r.internalNotes.filter(E=>E.id!==u.id);O.length!==r.internalNotes.length&&(S.internalNotes=O)}await a.update(r.id,S),o("حذف ملاحظة",`حذف ملاحظة للطالب ${r.name}`),c(M=>({...M,...S})),(p==null?void 0:p.id)===u.id&&(i(null),b(""))},I=u=>{i(u),b(u.text),w(u.type||"private")},d=()=>{const u=window.open("","PRINT","height=800,width=1000"),S=window.location.origin+de.LOGO,M=`
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>سجل الملاحظات - ${x}</title>
                <style>
                    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
                    body { font-family: 'Cairo', sans-serif; padding: 20px; font-size: 12px; color: #333; }
                    .header { text-align: center; border-bottom: 3px solid #fbbf24; padding-bottom: 20px; margin-bottom: 30px; }
                    .logo { height: 70px; margin-bottom: 10px; }
                    .student-box { border: 1px solid #eee; margin-bottom: 20px; border-radius: 8px; overflow: hidden; page-break-inside: avoid; }
                    .student-header { background: #f9fafb; padding: 10px 15px; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; }
                    .note-row { padding: 10px 15px; border-bottom: 1px solid #f0f0f0; display: flex; gap: 15px; align-items: flex-start; }
                    .note-label { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; min-width: 80px; text-align: center; }
                    .label-private { background: #fee2e2; color: #991b1b; }
                    .label-public { background: #dcfce7; color: #166534; }
                    .note-text { flex: 1; line-height: 1.5; }
                    .note-date { color: #999; font-size: 10px; margin-top: 4px; }
                </style>
            </head>
            <body>
                <div class="header">
                    <img src="${S}" class="logo" onerror="this.style.display='none'"/>
                    <h2>سجل الملاحظات والرسائل</h2>
                    <p>الفرع: ${x} | التاريخ: ${new Date().toLocaleDateString("ar-EG")}</p>
                </div>
                ${f.map(L=>{const O=N(L);return`
                    <div class="student-box">
                        <div class="student-header">
                            <span>${L.name}</span>
                            <span style="color:#666; font-size:11px;">${L.belt}</span>
                        </div>
                        ${O.map(E=>`
                            <div class="note-row">
                                <div>
                                    <div class="note-label ${E.type==="private"?"label-private":"label-public"}">
                                        ${E.type==="private"?"إدارية":"عامة"}
                                    </div>
                                    <div class="note-date">${E.date}</div>
                                </div>
                                <div class="note-text">${E.text}</div>
                            </div>
                        `).join("")}
                    </div>
                    `}).join("")}
                <script>window.onload = function() { window.print(); }<\/script>
            </body>
            </html>
        `;u.document.write(M),u.document.close()},$=N(r);return e.jsxs("div",{className:"h-[calc(100vh-140px)] flex flex-col md:flex-row gap-6 animate-fade-in",children:[e.jsxs("div",{className:"w-full md:w-1/3 flex flex-col gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100",children:[e.jsxs("h2",{className:"text-lg font-black text-gray-800 flex items-center gap-2 mb-4",children:[e.jsx(we,{className:"text-yellow-500"})," سجل الملاحظات"]}),e.jsx(Ye,{students:s,onSelect:c,onClear:()=>c(null),placeholder:"ابحث عن طالب..."}),e.jsxs(F,{onClick:d,variant:"outline",className:"w-full mt-3 text-xs",children:[e.jsx(be,{size:16})," طباعة تقرير الملاحظات"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-3 bg-gray-50 border-b border-gray-100 font-bold text-gray-500 text-xs",children:["طلاب لديهم ملاحظات مسجلة (",f.length,")"]}),e.jsx("div",{className:"overflow-y-auto custom-scrollbar p-2 space-y-1 flex-1",children:f.length>0?f.map(u=>e.jsxs("button",{onClick:()=>c(u),className:`w-full text-right p-3 rounded-xl border transition-all flex justify-between items-center group
                                    ${(r==null?void 0:r.id)===u.id?"bg-yellow-50 border-yellow-400 shadow-sm":"bg-white border-transparent hover:bg-gray-50 hover:border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${(r==null?void 0:r.id)===u.id?"bg-yellow-200 text-yellow-800":"bg-gray-100 text-gray-500"}`,children:u.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-gray-800",children:u.name}),e.jsx("p",{className:"text-[10px] text-gray-400",children:u.belt})]})]}),e.jsxs("div",{className:"flex gap-1",children:[N(u).some(S=>S.type==="private")&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),N(u).some(S=>S.type==="public")&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})]})]},u.id)):e.jsx("div",{className:"text-center py-10 text-gray-400 text-xs",children:"لا يوجد ملاحظات مسجلة"})})]})]}),e.jsx("div",{className:"w-full md:w-2/3 bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col overflow-hidden",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-black text-yellow-500 rounded-xl flex items-center justify-center font-bold text-lg",children:e.jsx(Ve,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:r.name}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-200 px-2 py-0.5 rounded text-[10px]",children:r.belt})]})]}),e.jsxs("div",{className:"text-xs text-gray-400 font-mono",children:["ID: ",r.id.substring(0,6)]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-gray-50/30",children:[$.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400 opacity-50",children:[e.jsx(we,{size:48,className:"mb-2"}),e.jsx("p",{children:"لا يوجد ملاحظات لهذا الطالب"})]}),$.map((u,S)=>e.jsxs("div",{className:`relative group p-4 rounded-2xl border transition-all hover:shadow-md
                                        ${u.type==="private"?"bg-white border-red-100 border-r-4 border-r-red-400":"bg-white border-green-100 border-r-4 border-r-green-400"}
                                        ${(p==null?void 0:p.id)===u.id?"ring-2 ring-yellow-400":""}
                                    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u.type==="private"?e.jsxs("span",{className:"bg-red-100 text-red-700 text-[10px] px-2 py-1 rounded-lg font-bold flex items-center gap-1",children:[e.jsx(pe,{size:10})," إدارية (خاص)"]}):e.jsxs("span",{className:"bg-green-100 text-green-700 text-[10px] px-2 py-1 rounded-lg font-bold flex items-center gap-1",children:[e.jsx(ue,{size:10})," عامة (للطالب)"]}),e.jsx("span",{className:"text-[10px] text-gray-400 font-bold",children:u.date}),u.isLegacy&&e.jsx("span",{className:"bg-gray-200 text-gray-600 text-[9px] px-1.5 py-0.5 rounded",children:"سجل قديم"})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>I(u),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",title:"تعديل",children:e.jsx(Fe,{size:14})}),e.jsx("button",{onClick:()=>m(u),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg",title:"حذف",children:e.jsx(ne,{size:14})})]})]}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-line leading-relaxed pl-2 border-r-2 border-gray-100 mr-1",children:u.text})]},u.id||S))]}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[p&&e.jsxs("div",{className:"flex justify-between items-center bg-yellow-50 px-3 py-2 rounded-lg mb-2 text-xs text-yellow-800 border border-yellow-200",children:[e.jsx("span",{children:"جاري تعديل ملاحظة..."}),e.jsx("button",{onClick:()=>{i(null),b("")},children:e.jsx(xe,{size:14})})]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("button",{onClick:()=>w("private"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1
                                        ${v==="private"?"bg-red-100 text-red-700 ring-1 ring-red-200":"bg-gray-50 text-gray-400 hover:bg-gray-100"}`,children:[e.jsx(pe,{size:12})," خاصة"]}),e.jsxs("button",{onClick:()=>w("public"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1
                                        ${v==="public"?"bg-green-100 text-green-700 ring-1 ring-green-200":"bg-gray-50 text-gray-400 hover:bg-gray-100"}`,children:[e.jsx(ue,{size:12})," عامة"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:"w-full bg-gray-50 border-2 border-gray-100 rounded-xl p-3 pr-4 pl-12 text-sm outline-none focus:border-yellow-400 focus:bg-white transition-all min-h-[50px] max-h-[120px]",placeholder:"اكتب الملاحظة هنا...",value:l,onChange:u=>b(u.target.value)}),e.jsx("button",{onClick:g,disabled:!l.trim(),className:"absolute left-2 bottom-2 bg-black text-yellow-500 p-2 rounded-lg hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:p?e.jsx(ve,{size:18}):e.jsx($e,{size:18})})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-300",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(_e,{size:32})}),e.jsx("p",{className:"font-bold",children:"اختر طالباً للبدء"})]})})]})}const tt=s=>{if(!s)return"expired";const a=new Date,o=new Date(s);a.setHours(0,0,0,0),o.setHours(0,0,0,0);const x=o-a,r=Math.ceil(x/(1e3*60*60*24));return r<0?"expired":r<=7?"near_end":"active"},Os=async(s,a,o,x)=>{try{await Re(he(ee,"artifacts",ie,"public","data","activity_logs"),{action:s,details:a,branch:o,performedBy:x.name||"Admin",role:x.role||"admin",timestamp:new Date().toISOString()})}catch(r){console.error("Log error",r)}},jt=({title:s,icon:a,items:o,activeTab:x,onSelect:r})=>{const[c,l]=j.useState(!1),b=j.useRef(null);j.useEffect(()=>{function w(p){b.current&&!b.current.contains(p.target)&&l(!1)}return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[b]);const v=o.some(w=>w.id===x);return e.jsxs("div",{className:"relative",ref:b,children:[e.jsxs("button",{onClick:()=>l(!c),className:`flex items-center gap-2 px-3 py-2 rounded-xl transition-all font-bold text-sm 
                    ${v?"text-yellow-400 bg-gray-800":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[e.jsx(a,{size:18}),e.jsx("span",{children:s}),e.jsx(ss,{size:14,className:`transition-transform ${c?"rotate-180":""}`})]}),c&&e.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50 animate-fade-in",children:o.map((w,p)=>e.jsxs("button",{onClick:()=>{w.action?w.action():r(w.id),l(!1)},className:`w-full text-right px-4 py-3 flex items-center gap-3 transition-colors text-sm font-bold border-b border-gray-50 last:border-0
                                ${x===w.id?"bg-yellow-50 text-yellow-700":"text-gray-600 hover:bg-gray-50"}
                                ${w.special?"text-green-600 bg-green-50 hover:bg-green-100":""}
                            `,children:[e.jsx(w.icon,{size:16,className:x===w.id?"text-yellow-600":w.special?"text-green-600":"text-gray-400"}),w.label,w.badge>0&&e.jsx("span",{className:"mr-auto bg-red-500 text-white text-[10px] px-1.5 rounded-full",children:w.badge})]},p))})]})},Es=({user:s,selectedBranch:a,studentsCollection:o,scheduleCollection:x,handleLogout:r,onSwitchBranch:c})=>{const[l,b]=j.useState("dashboard"),[v,w]=j.useState(!1),p=re("payments"),i=re("expenses"),N=re("archive"),f=re("registrations"),g=re("captains"),m=re("groups"),I=re("news"),d=re("finance_reasons"),$=re("activity_logs"),u=re("admin_notes"),S=(o==null?void 0:o.data)||[],M=(p==null?void 0:p.data)||[],L=(i==null?void 0:i.data)||[],O=(f==null?void 0:f.data)||[],E=(x==null?void 0:x.data)||[],n=(g==null?void 0:g.data)||[],k=(m==null?void 0:m.data)||[],U=(I==null?void 0:I.data)||[],h=(d==null?void 0:d.data)||[],A=($==null?void 0:$.data)||[],K=(u==null?void 0:u.data)||[],_=j.useMemo(()=>S.filter(z=>z.branch===a),[S,a]),W=j.useMemo(()=>M.filter(z=>z.branch===a),[M,a]),y=j.useMemo(()=>L.filter(z=>z.branch===a),[L,a]),G=j.useMemo(()=>O.filter(z=>z.branch===a),[O,a]),X=j.useMemo(()=>k.filter(z=>z.branch===a),[k,a]),ae=j.useMemo(()=>h.filter(z=>z.branch===a),[h,a]),le=K,ce=j.useMemo(()=>A.filter(z=>z.branch===a).sort((z,Z)=>new Date(Z.timestamp)-new Date(z.timestamp)),[A,a]),D=W.reduce((z,Z)=>z+Number(Z.amount||0),0),R=y.reduce((z,Z)=>z+Number(Z.amount||0),0),q=D-R,T=_.filter(z=>tt(z.subEnd)==="active").length,t=_.filter(z=>tt(z.subEnd)==="near_end").length,C=_.filter(z=>tt(z.subEnd)==="expired").length,P=_.length,H=new Date,Y=`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`,Q=_.reduce((z,Z)=>Z.attendance?z+Object.keys(Z.attendance).filter(ye=>ye.startsWith(Y)).length:z,0),B=(z,Z)=>Os(z,Z,a,s),te=()=>{if(!confirm("هل تريد تحميل نسخة كاملة من قاعدة البيانات؟"))return;const z={date:new Date().toISOString(),branch:a,students:_,payments:W,expenses:y,registrations:G,schedule:E,news:U,groups:X,captains:n,activityLogs:ce,adminNotes:le},Z="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(z,null,2)),ye=document.createElement("a");ye.setAttribute("href",Z),ye.setAttribute("download",`brave_backup_${a}_${new Date().toISOString().split("T")[0]}.json`),document.body.appendChild(ye),ye.click(),ye.remove()},oe=[{id:"students",icon:Ne,label:"الطلاب"},{id:"student_notes",icon:ts,label:"الملاحظات والرسائل"},{id:"subscriptions",icon:je,label:"اشتراكات"},{id:"tests",icon:Ct,label:"فحص"},{id:"finance",icon:We,label:"وصولات"},{id:"archive",icon:Te,label:"الأرشيف"}],me=[{id:"registrations",icon:Dt,label:"طلبات التسجيل",badge:G.length},{id:"schedule",icon:qe,label:"جدول الحصص"},{id:"notes",label:"ملاحظات الإدارة",icon:we},{id:"news",icon:ke,label:"الاخبار والعروض"},{id:"reports",icon:we,label:"التقارير الشاملة"},{id:"captains",icon:Je,label:"الكباتن والصلاحيات",role:"admin"},{id:"backup",icon:es,label:"باك اب داتابيس",role:"admin",action:te,special:!0}].filter(z=>!z.role||z.role===s.role);return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-right font-sans flex flex-col",dir:"rtl",children:[e.jsxs("header",{className:"bg-black text-white shadow-lg sticky top-0 z-40",children:[e.jsxs("div",{className:"container mx-auto px-4 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:de.LOGO,alt:"Logo",className:"w-10 h-10 rounded-lg object-contain bg-white",onError:z=>{z.target.style.display="none"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg hidden md:block",children:"أكاديمية الشجاع"}),e.jsxs("div",{className:"text-xs text-yellow-500 font-bold flex items-center gap-1",children:[s.name,e.jsx("span",{className:"text-gray-500",children:"|"}),a==="شفا بدران"?"فرع شفا بدران":"فرع أبو نصير"]})]})]}),e.jsxs("nav",{className:"hidden md:flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>b("dashboard"),className:`flex items-center gap-2 px-3 py-2 rounded-xl transition-all font-bold text-sm ${l==="dashboard"?"text-yellow-400 bg-gray-800":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[e.jsx(Ie,{size:18})," الرئيسية"]}),e.jsx("div",{className:"w-px h-6 bg-gray-700 mx-2"}),e.jsx(jt,{title:"طلاب",icon:Ne,items:oe,activeTab:l,onSelect:b}),e.jsxs("button",{onClick:()=>b("attendance"),className:`flex items-center gap-2 px-4 py-2 mx-2 rounded-xl transition-all font-bold text-sm border-2 border-yellow-500 ${l==="attendance"?"bg-yellow-500 text-black":"text-yellow-500 hover:bg-yellow-500 hover:text-black"}`,children:[e.jsx(ve,{size:22})," حضور وغياب"]}),e.jsx(jt,{title:"الادارة",icon:Je,items:me,activeTab:l,onSelect:b})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsxs("div",{className:"hidden md:block relative group",children:[e.jsx(Ae,{size:20,className:"text-gray-400 group-hover:text-yellow-500 cursor-pointer"}),e.jsxs("select",{value:a,onChange:z=>c(z.target.value),className:"absolute inset-0 opacity-0 cursor-pointer",children:[e.jsx("option",{value:"شفا بدران",children:"شفا بدران"}),e.jsx("option",{value:"أبو نصير",children:"أبو نصير"})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-red-400 hover:bg-gray-800 rounded-lg transition-colors",title:"خروج",children:e.jsx(vt,{size:20})}),e.jsx("button",{className:"md:hidden p-2 text-white",onClick:()=>w(!v),children:v?e.jsx(xe,{size:24}):e.jsx(yt,{size:24})})]})]}),v&&e.jsxs("div",{className:"md:hidden bg-gray-900 border-t border-gray-800 p-4 space-y-4 animate-fade-in absolute w-full left-0 z-50 shadow-2xl h-[calc(100vh-64px)] overflow-y-auto",children:[c&&e.jsxs("div",{className:"bg-gray-800 p-3 rounded-xl flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"الفرع الحالي:"}),e.jsxs("select",{value:a,onChange:z=>c(z.target.value),className:"bg-black text-yellow-500 font-bold p-2 rounded-lg outline-none text-sm",children:[e.jsx("option",{value:"شفا بدران",children:"شفا بدران"}),e.jsx("option",{value:"أبو نصير",children:"أبو نصير"})]})]}),e.jsxs("button",{onClick:()=>{b("dashboard"),w(!1)},className:"w-full flex items-center gap-3 p-3 rounded-xl bg-gray-800 text-white font-bold",children:[e.jsx(Ie,{size:20,className:"text-yellow-500"})," الرئيسية"]}),e.jsxs("button",{onClick:()=>{b("attendance"),w(!1)},className:"w-full flex items-center gap-3 p-3 rounded-xl bg-yellow-600 text-white font-bold shadow-lg shadow-yellow-900/20",children:[e.jsx(ve,{size:20})," حضور وغياب"]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-2 px-2 uppercase",children:"طلاب"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map(z=>e.jsxs("button",{onClick:()=>{b(z.id),w(!1)},className:`flex flex-col items-center justify-center gap-2 p-3 rounded-xl text-xs font-bold border transition-all ${l===z.id?"bg-yellow-500 text-black border-yellow-500":"bg-gray-800 text-gray-300 border-gray-700"}`,children:[e.jsx(z.icon,{size:20})," ",z.label]},z.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 mb-2 px-2 uppercase",children:"الادارة"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:me.map(z=>e.jsxs("button",{onClick:()=>{z.action?z.action():b(z.id),w(!1)},className:`flex flex-col items-center justify-center gap-2 p-3 rounded-xl text-xs font-bold border transition-all 
                                      ${z.special?"text-green-400 border-green-900 bg-green-900/20":l===z.id?"bg-yellow-500 text-black border-yellow-500":"bg-gray-800 text-gray-300 border-gray-700"}`,children:[e.jsx(z.icon,{size:20})," ",z.label]},z.id))})]})]})]}),e.jsxs("main",{className:"flex-1 w-full px-4 md:px-8 py-6 animate-fade-in mx-auto",children:[l==="dashboard"&&e.jsx(cs,{user:s,selectedBranch:a,branchStudents:_,netProfit:q,totalAttendance:Q,expiredCount:C,activeStudentsCount:T,nearEndCount:t,totalStudents:P,branchRegistrations:G,branchPayments:W,activityLogs:ce}),l==="students"&&e.jsx(gs,{students:_,groups:X,studentsCollection:o,archiveCollection:N,selectedBranch:a,logActivity:B}),l==="tests"&&e.jsx($s,{students:_,studentsCollection:o,logActivity:B}),l==="reports"&&e.jsx(zs,{students:_,payments:W,expenses:y,activityLogs:ce,registrations:G,adminNotes:le,selectedBranch:a}),l==="subscriptions"&&e.jsx(As,{students:_,studentsCollection:o,logActivity:B,selectedBranch:a}),l==="finance"&&e.jsx(js,{students:_,payments:W,expenses:y,paymentsCollection:p,expensesCollection:i,financeReasons:ae,financeReasonsCollection:d,selectedBranch:a,logActivity:B}),l==="attendance"&&e.jsx(Ns,{students:_,groups:X,groupsCollection:m,studentsCollection:o,selectedBranch:a}),l==="registrations"&&e.jsx(ks,{registrations:G,students:S,registrationsCollection:f,studentsCollection:o,selectedBranch:a,logActivity:B}),l==="schedule"&&e.jsx(Ss,{schedule:E,scheduleCollection:x}),l==="archive"&&e.jsx(us,{archiveCollection:N,studentsCollection:o,payments:M,logActivity:B}),l==="captains"&&e.jsx(Ds,{captains:n,captainsCollection:g}),l==="news"&&e.jsx(Cs,{news:U,newsCollection:I,selectedBranch:a}),l==="notes"&&e.jsx(is,{}),l==="student_notes"&&e.jsx(Ms,{students:_,studentsCollection:o,logActivity:B,selectedBranch:a})]})]})},st="brave-academy-live-data";function Ts(){const[s,a]=j.useState(()=>{const g=localStorage.getItem("braveUser");return g?JSON.parse(g):null}),[o,x]=j.useState(()=>typeof window<"u"&&localStorage.getItem("braveUser")?JSON.parse(localStorage.getItem("braveUser")).role==="student"?"student_portal":"admin_dashboard":"home"),[r,c]=j.useState(()=>s&&s.branch?s.branch:se.SHAFA),[l,b]=j.useState(!0),v=re("students"),w=re("schedule"),p=re("news"),i=g=>{x(g),window.history.pushState({view:g},"","")};j.useEffect(()=>{window.history.replaceState({view:o},"","");const g=m=>{m.state&&m.state.view?x(m.state.view):x("home")};return window.addEventListener("popstate",g),()=>window.removeEventListener("popstate",g)},[]);const N=async(g,m)=>{try{const I=he(ee,"artifacts",st,"public","data","students"),d=ze(I,Se("username","==",g),Se("password","==",m)),$=await at(d);if(!$.empty){const L=$.docs[0],O=L.data(),E={role:"student",familyId:O.familyId,name:O.familyName||O.name,id:L.id};a(E),localStorage.setItem("braveUser",JSON.stringify(E)),i("student_portal");return}const u=he(ee,"artifacts",st,"public","data","captains"),S=ze(u,Se("username","==",g),Se("password","==",m)),M=await at(S);if(!M.empty){const L=M.docs[0],O=L.data(),E={role:"captain",...O,id:L.id};a(E),localStorage.setItem("braveUser",JSON.stringify(E)),c(O.branch),i("admin_dashboard");return}if(g.includes("@")||g==="admin1"){let L=g;g==="admin1"&&(L="admin@brave.com"),await At(Xe,L,m);return}alert("بيانات الدخول خاطئة! تأكد من اسم المستخدم وكلمة المرور.")}catch(I){console.error("Login Error:",I),alert("حدث خطأ أثناء تسجيل الدخول.")}};j.useEffect(()=>{const g=It(Xe,async m=>{if(m){const I=m.email;let d={email:I};I==="admin@brave.com"?d={...d,role:"admin",isSuper:!0,name:"المدير العام",branch:se.SHAFA}:I==="shafa@brave.com"?d={...d,role:"admin",isSuper:!1,name:"مدير شفا بدران",branch:se.SHAFA}:I==="abunseir@brave.com"?d={...d,role:"admin",isSuper:!1,name:"مدير أبو نصير",branch:se.ABU_NSEIR}:I==="jehad@yahoo.com"?d={...d,role:"admin",isSuper:!1,name:"جهاد كعوش",branch:se.ABU_NSEIR}:I==="nseir@brave.com"&&(d={...d,role:"admin",isSuper:!1,name:"كمال كعوش",branch:se.ABU_NSEIR});try{const $=fe(ee,"artifacts",st,"public","data","admin_profiles",I),u=await qt($);u.exists()&&u.data().name&&(d.name=u.data().name)}catch{console.log("Profile fetch warning")}a(d),c(d.branch),localStorage.setItem("braveUser",JSON.stringify(d)),x("admin_dashboard")}else localStorage.getItem("braveUser")||a(null);b(!1)});return()=>g()},[]);const f=async()=>{await Mt(Xe),localStorage.removeItem("braveUser"),a(null),i("home")};return l&&s?e.jsx("div",{className:"flex h-screen items-center justify-center font-bold text-xl text-yellow-600 bg-gray-50",children:"جاري التأكد من البيانات..."}):e.jsxs(e.Fragment,{children:[o==="home"&&e.jsx(ns,{setView:i,schedule:w.data}),o==="login"&&e.jsx(os,{setView:i,handleLogin:N}),o==="student_portal"&&s&&e.jsx(ds,{user:s,students:v.data,schedule:w.data,news:p.data,handleLogout:f}),o==="admin_dashboard"&&s&&e.jsx(Es,{user:s,selectedBranch:r,onSwitchBranch:s.isSuper?c:null,studentsCollection:v,scheduleCollection:w,handleLogout:f})]})}$t(document.getElementById("root")).render(e.jsx(j.StrictMode,{children:e.jsx(Ts,{})}));
